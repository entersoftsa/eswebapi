/*! Entersoft Application Server WEB API - v1.13.0 - 2017-02-08
* Copyright (c) 2017 Entersoft SA; Licensed Apache-2.0 */
!function(){"use strict";function a(a,b){return-1!==a.indexOf(b,a.length-b.length)}function b(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())}var c=angular.module("es.Services.Web",["ngStorage"]);c.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login/Login",__LOGOUT__:"api/Login/Logout",__USER_LOGO__:"api/Login/UserLogo/",__REMOVE_USER_LOGO__:"api/Login/RemoveUserLogo/",__PERSON_LOGO__:"api/rpc/personLogo/",__POST_USER_LOGO__:"api/Login/UpdateUserLogo/",__EVENTLOG__:"api/rpc/EventLog/",__PUBLICQUERY__:"api/rpc/PublicQuery/",__MULTI_PULIC_QUERY__:"api/rpc/MultiPublicQuery/",__PUBLICQUERY_INFO__:"api/rpc/PublicQueryInfo/",__USERSITES__:"api/Login/Usersites",__STANDARD_ZOOM__:"api/rpc/FetchStdZoom/",__MULTI_STANDARD_ZOOM__:"api/rpc/MultiFetchStdZoom/",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__SCROLLER__:"api/rpc/SimpleScroller/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__FETCH_COMPANY_PARAM__:"api/rpc/FetchCompanyParam/",__FETCH_COMPANY_PARAMS__:"api/rpc/FetchCompanyParams/",__SCROLLER_COMMAND__:"api/rpc/ScrollerCommand/",__FORM_COMMAND__:"api/rpc/FormCommand/",__EBS_SERVICE__:"api/rpc/EbsService/",__FETCH_SESSION_INFO__:"api/rpc/FetchSessionInfo/",__FETCH_ODS_TABLE_INFO__:"api/rpc/FetchOdsTableInfo/",__FETCH_ODS_COLUMN_INFO__:"api/rpc/FetchOdsColumnInfo/",__FETCH_ODS_RELATION_INFO__:"api/rpc/FetchOdsRelationInfo/",__FETCH_ODS_DETAIL_RELATIONS_INFO__:"api/rpc/FetchOdsDetailRelationsInfo/",__FETCH_ODS_MASTER_RELATIONS_INFO__:"api/rpc/FetchOdsMasterRelationsInfo/",__FI_IMPORTDOCUMENT___:"api/rpc/FIImportDocument/",__FETCH_ENTITY__:"api/rpc/fetchEntity/",__FETCH_ENTITY_BY_CODE__:"api/rpc/fetchEntityByCode/",__FETCH_ESPROPERTY_SET__:"api/rpc/fetchPropertySet/",__FETCH_ESSCALE__:"api/rpc/fetchESScale/",__FETCH_WEB_EAS_ASSET__:"api/asset/",__FETCH_ES00DOCUMENT_BY_GID__:"api/ES00Documents/InfoByGID/",__FETCH_ES00DOCUMENT_BY_CODE__:"api/ES00Documents/InfoByCode/",__FETCH_ES00DOCUMENT_BY_ENTITYGID__:"api/ES00Documents/InfoByEntityGid/",__FETCH_ES00DOCUMENT_BLOBDATA_BY_GID__:"api/ES00Documents/BlobDataByGID/",__FETCH_ES00DOCUMENT_MIME_TYPES__:"api/ES00Documents/ESMimeTypes/",__DELETE_ES00DOCUMENT__:"api/ES00Documents/DeleteES00Document/",__ADD_OR_UPDATE_ES00DOCUMENT_BLOBDATA__:"api/ES00Documents/AddOrUpdateES00DocumentBlobData/"}),c.value("__WEBAPI_RT__",{url:""}),c.provider("esWebApi",function(){var c="",d="",e="",f={},g={host:"",allowUnsecureConnection:!1,subscriptionId:"",subscriptionPassword:"",bridgeId:"",additionalHeaders:{}};return{getSettings:function(){return g},getServerUrl:function(){return c},setSettings:function(h){var i="https://",j="http://";if(g=h,!g.host)throw new Error("host for Entersoft WEB API Server is not specified");if(g.host=g.host.trim(),b(g.host,i)?g.host=g.host.slice(i.length).trim():b(g.host,j)&&(g.host=g.host.slice(j.length).trim()),""==g.host)throw new Error("host for Entersoft WEB API Server is not specified");return a(g.host,"/")||(g.host+="/"),d=j+g.host,e=i+g.host,f=g.additionalHeaders,c=g.allowUnsecureConnection?d:e,this},$get:["$http","$log","$q","$timeout","$rootScope","$injector","ESWEBAPI_URL","esGlobals","esMessaging","esCache",function(a,b,h,i,j,k,l,m,n,o){function p(a){var b=a||{Authorization:m.getWebApiToken()};return angular.extend(b,f),b}function q(a,d){if(a){var e=angular.copy(a);try{$.ajax({type:"POST",url:c.concat(l.__EVENTLOG__),contentType:"application/json",headers:p(),data:JSON.stringify({exceptionData:e,exceptionStore:d},null,"	")});var f=m.getGA();f&&f.registerException(e)}catch(g){b.warn("Error logging failed"),b.error(g)}}}function r(){var b=h.defer(),d=o.getItem("ES_MIME_TYPES");if(d)return i(function(){b.resolve(d)}),b.promise;var e=c.concat(l.__FETCH_ES00DOCUMENT_MIME_TYPES__),f=m.trackTimer("ES00DOCUMENT_MIME","FETCH","");f.startTime();var g={method:"GET",headers:p(),url:e},j=a(g);return w(j,f).then(function(a){o.setItem("ES_MIME_TYPES",a.data),b.resolve(a.data)},function(){b.reject(arguments)}),b.promise}function s(b){if(!b||!b.ScrollerID||!b.CommandID)throw new Error("ScrollerID and CommandID properties must be defined");var d=c.concat(l.__SCROLLER_COMMAND__),e=m.trackTimer("SCR","COMMAND",b.ScrollerID.concat("/",b.CommandID));e.startTime();var f=a({method:"post",headers:p(),url:d,data:b});return f.then(function(){e.endTime().send()}),f}function t(b,d){var e=c+l[b]+d,f=h.defer(),g=o.getItem(e);if(g)return i(function(){f.resolve(g)}),f.promise;var j=a({method:"get",headers:p(),url:e});return w(j).then(function(a){o.setItem(e,a),f.resolve(a)},function(){f.reject(arguments)}),f.promise}function u(b){if(!b||!b.EntityID||!b.CommandID)throw new Error("EntityID and CommandID properties must be defined");var d=c+l.__FORM_COMMAND__,e=m.trackTimer("FORM","COMMAND",b.EntityID.concat("/",b.CommandID));e.startTime();var f=a({method:"post",headers:p(),url:d,data:b});return w(f,e)}function v(b,d,e,f){d=d?d.trim():"",e=e?e.trim():"";var g=c.concat(b,d,"/",e),h=m.trackTimer("SCR","FETCH",d.concat("/",e));h.startTime();var i=a({method:"GET",headers:p(),url:g,params:f});return w(i,h)}function w(a,c){if(!a)throw new Error("processWEBAPIToken can have parameter promise null or undefined");var d=function(a,b){var c;a&&(c=a.headers(),c&&c["x-es-refresh-token"]&&m.setWebApiToken(c["x-es-refresh-token"],a.config.url||"-"))};return a.then(d,d),c&&a.then(function(){c.endTime().send()}),a.error(function(a,d){c&&c.endTime().send(),a?b.error(a):console.log("Generic Http error"),n.publish("ES_HTTP_CORE_ERR",a,d)}),a}return{getServerUrl:function(){return c},openSession:function(b,d){var e=m.trackTimer("AUTH","LOGIN","");e.startTime();var f={SubscriptionID:b.subscriptionId||g.subscriptionId,SubscriptionPassword:b.subscriptionPassword||g.subscriptionPassword,BridgeID:b.bridgeId||g.bridgeId,Model:b,Claims:d||g.claims};b.StickySession&&(f.SessionSpec="*");var h=a({method:"post",url:c+l.__LOGIN__,headers:p({}),data:f}).success(function(a){m.sessionOpened(a,b)}).error(function(a,b,c,d){m.sessionClosed()});return w(h,e)},eventLog:function(b){if(!b)throw new Error("esLog parameter cannot be empty");var d=m.trackTimer("AUTH","EVENTLOG",b.ID||"NO-ID");d.startTime();var e=a({method:"post",headers:p(),url:c+l.__EVENTLOG__,data:JSON.stringify(b)});return w(e,d)},ebsService:function(b,d){if(!(b&&b.netAssembly&&b.netNamespace&&b.netClass&&b.netMethod))throw new Error("serviceObj.netAssembly, serviceObj.netNamespace, serviceObj.netClass, serviceObj.netMethod properties MUST ALL have value");var e=b.netAssembly.concat("/",b.netNamespace,"/",b.netClass,"/",b.netMethod),f=d,g=m.trackTimer("EBS_SERVICE",b.netMethod,e);g.startTime();var h={method:"post",headers:p(),url:c.concat(l.__EBS_SERVICE__,e),data:f};b.netIsBinaryResult?(h.headers.Accept=void 0,h.responseType="arraybuffer"):h.contentType="application/json; charset=utf-8";var i=a(h);return w(i,g)},fetchUserLogo:function(b){var d=m.trackTimer("USER","LOGO",b||"NO-ID");d.startTime();var e=a({method:"get",headers:p(),url:c.concat(l.__USER_LOGO__,b||"")});return w(e,d)},uploadUserLogo:function(a,b,d,e){if(!a)throw new Error("Invalid File");var f=k.get("Upload");if(!f)throw new Error("You have to include the ngFileUpload");var g=m.trackTimer("USER","UPLOAD LOGO",a);return g.startTime(),a.upload=f.upload({url:c.concat(l.__POST_USER_LOGO__),method:"POST",headers:p(),file:a}),a.upload.then(function(c){i(function(){a.result=c.data,g.endTime().send(),angular.isFunction(b)&&b(a)})},d),a.upload.progress(e),a.upload},removeCurrentUserLogo:function(){var b=m.trackTimer("USER","REMOCE LOGO","");b.startTime();var d=a({method:"POST",headers:p(),url:c.concat(l.__REMOVE_USER_LOGO__)});return w(d,b)},fetchPersonLogo:function(b){if(!b)throw new Error("Invalid personGID");var d=m.trackTimer("PERSON","LOGO",b);d.startTime();var e=a({method:"get",headers:p(),url:c.concat(l.__PERSON_LOGO__,b)});return w(e,d)},logout:function(){var b=p();m.sessionClosed(),o.clear();var d=m.trackTimer("AUTH","LOGOUT","");d.startTime();var e=a({method:"post",headers:b,url:c.concat(l.__LOGOUT__)});return e["catch"](function(a){})},fetchCompanyParam:function(b){if(!b)return void 0;var d=c.concat(l.__FETCH_COMPANY_PARAM__,b.replace(" ","")),e=a({method:"get",headers:p(),url:d});return w(e)},fetchCompanyParams:function(b){var d;d=b?angular.isArray(b)?c+l.__FETCH_COMPANY_PARAMS__+b.join("/").replace(/ /g,""):c+l.__FETCH_COMPANY_PARAMS__+b.replace(/,/g,"/").replace(/ /g,""):c+l.__FETCH_COMPANY_PARAMS__;var e=a({method:"get",headers:p(),url:d});return w(e)},registerException:q,fetchOdsTableInfo:function(a){return a=a?a.trim():"",t("__FETCH_ODS_TABLE_INFO__",a)},fetchOdsColumnInfo:function(a,b){a=a?a.trim():"",b=b?b.trim():"";var c="";if(b)c=a+"/"+b;else{var d=a.split(".");c=2==d.length?d[0]+"/"+d[1]:a}return t("__FETCH_ODS_COLUMN_INFO__",c)},fetchOdsRelationInfo:function(a){return a=a?a.trim():"",t("__FETCH_ODS_RELATION_INFO__",a)},fetchOdsMasterRelationsInfo:function(a,b){return a=a?a.trim():"",b=b?b.trim():"",t("__FETCH_ODS_MASTER_RELATIONS_INFO__",a+"/"+b)},fetchOdsDetailRelationsInfo:function(a,b){return a=a?a.trim():"",b=b?b.trim():"",t("__FETCH_ODS_DETAIL_RELATIONS_INFO__",a+"/"+b)},fetchServerCapabilities:function(){var b=h.defer();return a.get(d+l.__SERVER_CAPABILITIES__).success(function(a){b.resolve(a)}).error(function(){a.get(e+l.__SERVER_CAPABILITIES__).success(function(a){b.resolve(a)}).error(function(a,c,d,e){b.reject([a,c,d,e])})}),b.promise},fetchScroller:function(a,b,c){return v(l.__SCROLLER__,a,b,c)},fetchSimpleScrollerRootTable:function(a,b,c){return v(l.__SCROLLERROOTTABLE__,a,b,c)},fetchUserSites:function(b,d){d=d||{};var e=a({method:"post",url:c+l.__USERSITES__,data:{SubscriptionID:d.subscriptionId||g.subscriptionId,SubscriptionPassword:d.subscriptionPassword||g.subscriptionPassword,BridgeID:d.bridgeId||g.bridgeId,Model:b}});return w(e)},fetchSessionInfo:function(){var b=a({method:"get",headers:p(),url:c+l.__FETCH_SESSION_INFO__});return w(b)},executeNewEntityAction:function(b,d,e){var f=c.concat(l.__ENTITYACTION__,b,"/",d),g=m.trackTimer("ACTION","NEW_ENTITY",b.concat("/",d));g.startTime();var h=a({method:"post",headers:p(),url:f,data:e});return w(h,g)},executeEntityActionByCode:function(b,d,e,f){var g=c.concat(l.__ENTITYACTION__,b,"/",d,"/",e),h=m.trackTimer("ACTION","ENTITY_CODE",b.concat("/",e));h.startTime();var i=a({method:"post",headers:p(),url:g,data:f});return w(i,h)},executeEntityActionByGID:function(b,d,e,f){var g=c.concat(l.__ENTITYBYGIDACTION__,b,"/",d,"/",e),h=m.trackTimer("ACTION","ENTITY_GID",b.concat("/",e));h.startTime();var i=a({method:"post",headers:p(),url:g,data:f});return w(i,h)},executeFormCommand:function(a){return u(a)},executeFormCommandDS:function(a,b,c,d){var e={EntityID:a,CommandID:b,CommandParams:c};return d&&(e.EntityDataset=d),u(e)},executeScrollerCommandSRV:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerParams:d,CommandParams:e};return s(f)},executeScrollerCommandDS:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerDataset:d,CommandParams:e};return s(f)},fetchPublicQueryInfo:function(b,d,e){var f="";b instanceof m.ESPublicQueryDef?(f=(b.GroupID||"").trim(),d=(b.FilterID||"").trim()):(f=b?b.trim():"",d=d?d.trim():"");var g=c.concat(l.__PUBLICQUERY_INFO__,f,"/",d),j=h.defer();if(e){var k=o.getItem(g);if(k)return i(function(){j.resolve(k)}),j.promise}var n=m.trackTimer("PQ","INFO",f.concat("/",d));n.startTime();var q=a({method:"get",headers:p(),url:g});return w(q,n).then(function(a){e&&o.setItem(g,a),j.resolve(a)},function(){j.reject(arguments)}),j.promise},fetchStdZoom:function(b,d,e){b=b?b.trim():"",e=!d&&e;var f=h.defer();if(e){var g=o.getItem("ESZOOM_"+b);if(g)return i(function(){f.resolve(g)}),f.promise}var j=c.concat(l.__STANDARD_ZOOM__,b),k=m.trackTimer("ZOOM","FETCH",b);k.startTime();var n=a({method:"get",headers:p({Authorization:m.getWebApiToken(),"X-ESPQOptions":JSON.stringify(d)}),url:j}),q=w(n,k);return q.then(function(a){e&&o.setItem("ESZOOM_"+b,a),f.resolve(a)},function(){f.reject(arguments)}),f.promise},fetchMultiStdZoom:function(b){var d=h.defer(),e=[];b=b||[];var f=_.filter(b,function(a){return a.UseCache&&o.getItem("ESZOOM_"+a.ZoomID)?!1:!0});if(0==f.length)return i(function(){var a;for(a=0;a<b.length;a++)e.push(o.getItem("ESZOOM_"+b[a].ZoomID));d.resolve(e)}),d.promise;var g=c.concat(l.__MULTI_STANDARD_ZOOM__),j=m.trackTimer("ZOOM","MULTI_FETCH","");j.startTime();var k=a({method:"POST",headers:p(),data:f,url:g}),n=w(k,j);return n.then(function(a){var c=0;_.each(b,function(b){if(b.UseCache&&o.getItem("ESZOOM_"+b.ZoomID))e.push(o.getItem("ESZOOM_"+b.ZoomID));else{var d=a[c];c+=1,b.UseCache&&o.setItem("ESZOOM_"+b.ZoomID,d),e.push(d)}}),d.resolve(e)},function(){d.reject(arguments)}),d.promise},fetchPublicQuery:function(b,d,e,f,g){var h,i;b instanceof m.ESPublicQueryDef?(h=(b.GroupID||"").trim(),d=(b.FilterID||"").trim(),e=b.PQOptions,i=b.Params):(h=b?b.trim():"",d=d?d.trim():"",i=f),i&&i instanceof m.ESParamValues&&(i=i.getExecuteVals());var j=c.concat(l.__PUBLICQUERY__,h,"/",d),k=m.trackTimer("PQ","FETCH",h.concat("/",d));k.startTime();var n={headers:p(),url:j,params:i};e&&(n.headers["X-ESPQOptions"]=JSON.stringify(e)),n.method=g||"GET","GET"!==n.method&&(delete n.params,n.data=i);var o=a(n);return w(o,k)},multiPublicQuery:function(b){var d=c.concat(l.__MULTI_PULIC_QUERY__),e=m.trackTimer("MULTI-PQ","FETCH","");e.startTime();var f={headers:p(),url:d,method:"POST"};f.data=b;var g=a(f);return w(g,e)},fetchEASWebAsset:function(b,d){var e={base64:!1};d?(e.base64=!!d.base64,e.responseType=d.responseType,e.Accept=d.Accept):e.responseType="arraybuffer";var f=c.concat(l.__FETCH_WEB_EAS_ASSET__,b),g=m.trackTimer("EAS_ASSET","FETCH",b);g.startTime();var h={method:"GET",headers:p(),url:f,params:{base64:e.base64}};h.headers.Accept=e.Accept,e.responseType&&(h.responseType=e.responseType);var i=a(h);return w(i,g)},fetchEntity:function(b,d){if(!b||!d)throw new Error("Invalid parameters");var e=c.concat(l.__FETCH_ENTITY__,b,"/",d),f=m.trackTimer("FETCH_ENTITY",b,d);f.startTime();var g=a({method:"get",headers:p(),url:e});return w(g,f)},fetchEntityByCode:function(b,d){if(!b||!d)throw new Error("Invalid parameters");var e=c.concat(l.__FETCH_ENTITY_BY_CODE__,b,"/",d),f=m.trackTimer("FETCH_ENTITY",b,d);f.startTime();var g=a({method:"get",headers:p(),url:e});return w(g,f)},fetchPropertySet:function(b,d){if(!b)throw new Error("Invalid parameter");d&&(b=b+"/"+d);var e=c.concat(l.__FETCH_ESPROPERTY_SET__,b),f=m.trackTimer("FETCH","PROPERTY_SET",b);f.startTime();var g=a({method:"get",headers:p(),url:e});return w(g,f)},fetchESScale:function(b){if(!b)throw new Error("Invalid parameter");b=b.toLowerCase();var d=h.defer(),e=o.getItem("ESGOSCALE_"+b);if(e)return i(function(){d.resolve(e)}),d.promise;var f=c.concat(l.__FETCH_ESSCALE__,b),g=m.trackTimer("FETCH","FETCH_SCALE",b);g.startTime();var j=a({method:"get",headers:p(),url:f});return w(j,g).then(function(a){o.setItem("ESGOSCALE_"+b,a.data),d.resolve(a.data)},function(){d.reject(arguments)}),d.promise},fiImportDocument:function(b){if(!b)throw new Error("xmldocstr is not a valid string");var d=c.concat(l.__FI_IMPORTDOCUMENT___),e=m.trackTimer("ESGENERAL","FIMPORTDOCUMENT");e.startTime();var f=a({method:"post",headers:p(),url:d,data:b});return w(f,e)},fetchES00DocumentBlobDataByGID:function(b){var d=c.concat(l.__FETCH_ES00DOCUMENT_BLOBDATA_BY_GID__,b),e=m.trackTimer("ES00DOCUMENT_BLOBDATA","FETCH",b);e.startTime();var f={method:"GET",headers:p({Authorization:m.getWebApiToken(),Accept:void 0}),url:d,params:{base64:!1},responseType:"arraybuffer"},g=a(f);return w(g,e)},getMimeTypes:r,fetchES00DocumentByGID:function(b){b=b?b.trim():"";var d=c.concat(l.__FETCH_ES00DOCUMENT_BY_GID__,b),e=m.trackTimer("ES00DOCUMENT","FETCH",b);e.startTime();var f=a({method:"get",headers:p(),url:d});return w(f,e)},fetchES00DocumentByCode:function(b){b=b?b.trim():"";var d=c.concat(l.__FETCH_ES00DOCUMENT_BY_CODE__,b),e=m.trackTimer("ES00DOCUMENT","FETCH",b);e.startTime();var f=a({method:"get",headers:p(),url:d});return w(f,e)},fetchES00DocumentsByEntityGID:function(b){b=b?b.trim():"";var d=c.concat(l.__FETCH_ES00DOCUMENT_BY_ENTITYGID__,b),e=m.trackTimer("ES00DOCUMENT_S","FETCH",b);e.startTime();var f=a({method:"get",headers:p(),url:d});return w(f,e)},deleteES00Document:function(b){if(b=b||{},!(b.TableID&&b.TableName&&b.GID&&b.fGID))throw new Error("Invalid parameter. One or more of the properties TableID, TableName, fGID and GID are not specified");var d=c.concat(l.__DELETE_ES00DOCUMENT__),e=m.trackTimer("ES00DOCUMENT_S","DELETE",b.GID);e.startTime();var f=a({method:"post",headers:p(),url:d,data:b});return w(f,e)},addOrUpdateES00Document:function(a,b,d,e,f){var g=m.trackTimer("ES00DOCUMENT_S","UPLOAD",b);if(g.startTime(),!b)throw new Error("Invalid File");var h=k.get("Upload");if(!h)throw new Error("You have to include the ngFileUpload");return b.upload=h.upload({url:c.concat(l.__ADD_OR_UPDATE_ES00DOCUMENT_BLOBDATA__),method:"POST",headers:p(),fields:{esdoc:JSON.stringify(a)},file:b}),b.upload.then(function(a){i(function(){b.result=a.data,g.endTime().send(),d(b)})},e),b.upload.progress(f),b.upload},eSearch:function(b,d,e){var f=c.concat(l.__ELASTICSEARCH__,b),g=m.trackTimer("ELASTIC_SEARCH",d||"",e||"");g.startTime();var h=a({method:d,headers:p(),url:f,data:e}).success(function(a){g.endTime().send();var c=m.getGA();c&&c.registerEventTrack({category:"ELASTIC_SEARCH",action:"SEARCH",label:b})}).error(function(a){try{g.endTime().send(),q(a)}catch(b){}});return w(h)}}}]}}),c.factory("esElasticSearch",["esWebApi",function(a){return{searchIndex:function(b,c){var d=b+"/_search";return a.eSearch(d,"post",c)},searchIndexAndDocument:function(b,c,d){var e=b+"/"+c+"/_search";return a.eSearch(e,"post",d)},searchFree:a.eSearch}}])}(),function(){"use strict";var a=angular.module("es.Services.Analytics",[]);a.provider("es.Services.GA",function(){var a={gaKey:void 0,pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},developerMode:!1};return{setGAKey:function(a){gaKey=a},settings:a,virtualPageviews:function(a){this.settings.pageTracking.autoTrackVirtualPages=a},firstPageview:function(a){this.settings.pageTracking.autoTrackFirstPage=a},withBase:function(a){this.settings.pageTracking.basePath=a?angular.element("base").attr("href").slice(0,-1):""},withAutoBase:function(a){this.settings.pageTracking.autoBasePath=a},developerMode:function(a){this.settings.developerMode=a},start:function(b,c){window.ga&&b&&""!=b&&(a.gaKey=b,ga("create",b,c))},$get:["$window",function(b){return{settings:a,registerPageTrack:function(a){b.ga&&b.ga("send","pageview",a)},registerException:function(a){b.ga&&a&&b.ga("send","exception",{exDescription:JSON.stringify(a),exFatal:!1})},registerTiming:function(a){if(b.ga){if(!(a&&a.timingCategory&&a.timingVar&&a.timingValue))return;if(a.timingValue){var c=parseInt(a.timingValue,10);if(a.timingValue=isNaN(c)?0:c,0==a.timingValue)return}b.ga("send","timing",a)}},registerEventTrack:function(a){if(b.ga){if(!a||!a.category)return;if(a.value){var c=parseInt(a.value,10);a.value=isNaN(c)?0:c}for(var d={eventCategory:a.category||null,eventAction:a.action||null,eventLabel:a.label||null,eventValue:a.value||null,nonInteraction:a.noninteraction||null},e=1;20>=e;e++)a["dimension"+e.toString()]&&(d["dimension"+e.toString()]=a["dimension"+e.toString()]),a["metric"+e.toString()]&&(d["metric"+e.toString()]=a["metric"+e.toString()]);b.ga("send","event",d)}}}}]}}),a.run(["$rootScope","$window","es.Services.GA","$injector",function(a,b,c,d){c.settings.pageTracking.autoTrackFirstPage&&d.invoke(["$location",function(a){var e=!0;if(d.has("$route")){var f=d.get("$route");for(var g in f.routes){e=!1;break}}else if(d.has("$state")){var h=d.get("$state");for(var i in h.get()){e=!1;break}}if(e)if(c.settings.pageTracking.autoBasePath&&(c.settings.pageTracking.basePath=b.location.pathname),c.settings.trackRelativePath){var j=c.settings.pageTracking.basePath+a.url();c.registerPageTrack(j,a)}else c.registerPageTrack(a.absUrl(),a)}]),c.settings.pageTracking.autoTrackVirtualPages&&d.invoke(["$location",function(e){c.settings.pageTracking.autoBasePath&&(c.settings.pageTracking.basePath=b.location.pathname+"#"),d.has("$route")&&a.$on("$routeChangeSuccess",function(a,b){if(!b||!(b.$$route||b).redirectTo){var d=c.settings.pageTracking.basePath+e.url();c.registerPageTrack(d,e)}}),d.has("$state")&&a.$on("$stateChangeSuccess",function(a,b){var d=c.settings.pageTracking.basePath+e.url();c.registerPageTrack(d,e)})}]),c.settings.developerMode&&angular.forEach(c,function(a,b){"function"==typeof a&&(c[b]=function(){})})}]),a.directive("esAnalyticsOn",["$document","es.Services.GA",function(a,b){function c(a){return a.tagName.toLowerCase()+":"+(a.type||"")=="a:"}function d(a){return["button:","button:button","button:submit","input:button","input:submit"].indexOf(a.tagName.toLowerCase()+":"+(a.type||""))>=0}function e(a){return d(a)||c(a),"click"}function f(b){if(d(b))return"Command";if(c(b)){if(!b.href)return"Navigate";var e=b.href,f=/\.(mov|jpg|png|rar|avi|zip|exe|pdf|doc*|xls*|ppt*|mp*)$/i;if(e.match(/^https?\:/i)){var g=e.match(f);return e.match(a[0].domain)?g?"Internal Download":"Internal Link":g?"External Download":"External Link"}return e.match(/^mailto\:/i)?"Mail To":e.match(f)?"Download":"Navigate"}return b.id||b.name||b.tagName}function g(a){return d(a)?a.tagName.toLowerCase()+":"+(a.type||""):c(a)?a.href?a.href:a.innerText||a.value:a.id||a.name||a.tagName}function h(a){return d(a)||c(a)?a.innerText||a.value:a.id||a.name||a.tagName}function i(a){return"esAnalytics"===a.substr(0,11)&&-1===["On","If","Properties","EventType"].indexOf(a.substr(11))}function j(a){var b=a.slice(11);return"undefined"!=typeof b&&null!==b&&b.length>0?b.substring(0,1).toLowerCase()+b.substring(1):b}return{restrict:"A",link:function(c,d,k){var l=k.esAnalyticsOn||e(d[0]),m={};angular.forEach(k.$attr,function(a,b){i(b)&&(m[j(b)]=k[b],k.$observe(b,function(a){m[j(b)]=a}))}),m.category=m.category||f(d[0],a),m.action=m.action||g(d[0],a),m.label=m.label||h(d[0],a),angular.element(d[0]).bind(l,function(a){(!k.esAnalyticsIf||c.$eval(k.esAnalyticsIf))&&(k.esAnalyticsProperties&&angular.extend(m,c.$eval(k.esAnalyticsProperties)),b.registerEventTrack(m))})}}}])}(),function(a){"use strict";a.module("es.services.Web.Environment",[]).provider("Environment",[function(){function a(){var a=document.location.href.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return a&&a[1]}var b={dev:[],prod:[],staging:[]},c="dev",d="/KB/app/images",e="/KB/app/templates";return{setStage:function(a){c=a},getStage:function(){return c},setAssetsPath:function(a){d=a},setTemplatesPath:function(a){e=a},addDevelopmentDomains:function(a){return b.dev=a,this},addProductionDomains:function(a){return b.prod=a,this},addStagingDomains:function(a){return b.staging=a,this},setStageFromDomain:function(){var d;for(var e in b)if(d=a(),b[e].indexOf(d)>=0){c=e;break}},$get:function(){return{stage:c,assetsPath:d,templatesPath:e,isDev:function(){return"dev"===c},isProduction:function(){return"prod"===c},isStaging:function(){return"staging"===c},getAssetsPath:function(){return d},getTemplatesPath:function(){return e}}}}}])}(window.angular),function(){"use strict";var a=angular.module("underscore",[]);a.factory("_",function(){return window._});var b="1.13.0",c=_.map(b.split("."),function(a){return parseInt(a)}),d={Major:c[0],Minor:c[1],Patch:c[2]},e={mobile:void 0},f=angular.module("es.Services.Web");f.provider("esCache",function(){var a=null,b={capacity:Number.MAX_VALUE,storageMode:"memory"};return{setCapacity:function(a){angular.isNumber(a)?b.capacity=a:b.capacity=Number.MAX_VALUE},getCapacity:function(){return b.capacity},getSettings:function(){return b},setStorageSettings:function(a){b&&(b.storageMode=a||"memory")},$get:["$cacheFactory",function(c){return a=c("esCache",b),{getItem:function(b){return a.get(b)},setItem:function(b,c,d){a.put(b,c)},removeItem:function(b){a.remove(b)},clear:function(){a.removeAll()},stats:function(){return a.info()}}}]}}),f.factory("esMessaging",function(){function a(){if(!arguments||arguments.Length<1)throw"Publishing events requires at least one argument for topic id";var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d[a]&&angular.forEach(d[a],function(c){try{c.apply(null,b)}catch(d){console.log("Error in messaging handler for topic ",a)}})}function b(a,b){return d[a]||(d[a]=[]),d[a].push(b),[a,b]}function c(a){var b=a[0];d[b]&&angular.forEach(d[b],function(c){c==a[1]&&d[b].splice(c,1)})}var d={},e={publish:a,subscribe:b,unsubscribe:c};return e}),f.factory("esGeoLocationSrv",["$q","$window",function(a,b){function c(){var c=a.defer();return b.navigator.geolocation?b.navigator.geolocation.getCurrentPosition(function(a){c.resolve(a)},function(a){c.reject(a)}):c.reject("Geolocation not supported."),c.promise}return{getCurrentPosition:c}}]),f.factory("esGlobals",["$translate","$rootScope","$sessionStorage","$log","esMessaging","esCache","$injector",function(a,b,c,f,g,h,i){function j(a){if(!a)return"en-US";var b=a.split("-")[0];if(!b)return"es-US";b=b.toLowerCase();var c=_.find(F,function(a){return b==a.id.split("-")[0].toLowerCase()});return c?c.id:"en-US"}function k(a){return a?"gid"+a.replace(/-/g,"_"):"gid"}function l(a){return a?"gid"!=a.slice(0,"gid".length)?a:a.slice(3).replace(/_/g,"-"):""}function m(a){this.ps=a}function n(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function o(a){var b=(16711680&a)>>16,c=(65280&a)>>8,d=255&a;return"#"+n(b)+n(c)+n(d)}function p(a,b,c,d,e,f,g){this.CtxID=a,this.GroupID=b,this.FilterID=c,this.PQOptions=d,this.Params=e,this.UIOptions=f,this.esPanelOpen=g,this.initFromObj=function(a){var b=a||{};this.CtxID=b.CtxID,this.GroupID=b.GroupID,this.FilterID=b.FilterID,this.PQOptions=(new r).initFromObj(b.PQOptions),this.Params=b.Params,this.esPanelOpen=b.esPanelOpen,this.UIOptions=b.UIOptions;for(var c in a)this.hasOwnProperty(c)||(this[c]=a[c]);return this}}function q(a,b,c){this.ZoomID=a,this.PQOptions=b,this.UseCache=!!c}function r(a,b,c,d,e){this.Page=a||-1,this.PageSize=b||-1,this.WithCount=!!c,this.ServerPaging=angular.isUndefined(d)||null==d?!0:d,this.AutoExecute=!!e,this.getPageSizeForServer=function(){return this.ServerPaging?this.PageSize:-1},this.getPageSizeForUI=function(){return this.PageSize<1?20:this.PageSize},this.initFromObj=function(a){var b=a||{};return this.Page=b.Page||-1,this.PageSize=b.PageSize||-1,this.WithCount=!!b.WithCount,this.ServerPaging=angular.isUndefined(b.ServerPaging)||null==b.ServerPaging?!0:b.ServerPaging,this.AutoExecute=!!b.AutoExecute,this}}function s(a,b,c){this.paramCode=a,this.paramValue=b,this.enumList=c}function t(a,b){s.call(this,a,b)}function u(a,b){s.call(this,a,b)}function v(a,b){b||(b={dRange:"ESDateRange(SpecificDate, #9999/01/01#, SpecificDate, #1753/01/01#)",fromD:null,toD:null}),s.call(this,a,b)}function w(a){this.setParamValues(a)}function x(){if(!i)return void 0;try{return i.get("es.Services.GA")}catch(a){return void 0}}function y(){if(!I.connectionModel){var a=c,b=null;if("undefined"!=typeof a.__esrequest_sesssion&&null!==a.__esrequest_sesssion){b=a.__esrequest_sesssion,I.connectionModel=b,g.publish("AUTH_CHANGED",I,B(b));var d=x();angular.isDefined(d)&&d.registerEventTrack({category:"AUTH",action:"RELOGIN",label:I.connectionModel.GID}),f.info("RELOGIN User ",I.connectionModel.Name)}else g.publish("AUTH_CHANGED",null,B(null)),f.info("NO RELOGIN from stored state")}return I.connectionModel}function z(a){var b=null;if(I.connectionModel&&(b=I.connectionModel.GID),I.connectionModel=a,a)c.__esrequest_sesssion=a;else{delete c.__esrequest_sesssion;var d=x();angular.isDefined(d)&&d.registerEventTrack({category:"AUTH",action:"LOGOUT",label:b})}g.publish("AUTH_CHANGED",I,B(a))}function A(b,c){var d={isLogin:!1,messageToShow:""};if(b&&!_.isString(b)&&_.isArrayLike(b)&&(b=b[0]),!b){switch(c){case 401:d.isLogin=!0,d.messageToShow=a.instant("ERR_401");break;case 403:d.isLogin=!0,d.messageToShow=a.instant("ERR_403");break;case 500:default:d.isLogin=!0,d.messageToShow=a.instant("ERR_500")}return d}if(b instanceof ArrayBuffer)try{b=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b)))}catch(e){}if(d.isLogin=401==b.status||403==b.status||401==c||403==c,b.data&&b.data instanceof ArrayBuffer)try{b.data=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b.data)))}catch(e){}var f="";if(b=b.data||b,b.UserMessage){if(f=b.UserMessage,b.MessageID){var g=a.instant(b.MessageID);g!=b.MessageID&&(f=g),f=f+" ("+b.MessageID+")"}return d.messageToShow=f,d}if(b.Messages){if(angular.isArray(b.Messages)){var h=0;f=_.reduce(b.Messages,function(a,b){return a+"\r\n["+ ++h+"] "+b},"")}else f=b.Messages;return d.messageToShow=f?f:a.instant("ERR_GENERAL"),d}return d.messageToShow=b.toString(),d}function B(a){return a?"Bearer "+a.WebApiToken:""}function C(a,b,c){return this.category=a,this.variable=b,this.label=c?c:void 0,this.startTime,this.endTime,this}var D=[],E=[];b.$on("$translateChangeSuccess",function(){var b=a.instant(["ESCOMPLEX.EQ","ESCOMPLEX.NE","ESCOMPLEX.LT","ESCOMPLEX.LE","ESCOMPLEX.GT","ESCOMPLEX.GE","ESCOMPLEX.RANGE","ESCOMPLEX.NULL","ESCOMPLEX.NOTNULL","ESDATE_RANGE.SDR","ESDATE_RANGE.SD","ESDATE_RANGE.ANY","ESDATE_RANGE.TODAY","ESDATE_RANGE.UTD","ESDATE_RANGE.SFTD","ESDATE_RANGE.YTD","ESDATE_RANGE.UTYD","ESDATE_RANGE.TMR","ESDATE_RANGE.SFTR","ESDATE_RANGE.CW","ESDATE_RANGE.PW","ESDATE_RANGE.NW","ESDATE_RANGE.CM","ESDATE_RANGE.PM","ESDATE_RANGE.NM","ESDATE_RANGE.SFM","ESDATE_RANGE.UEM","ESDATE_RANGE.SFLM","ESDATE_RANGE.UELM","ESDATE_RANGE.CQ","ESDATE_RANGE.PQ","ESDATE_RANGE.CSM","ESDATE_RANGE.PSM","ESDATE_RANGE.CY","ESDATE_RANGE.PY","ESDATE_RANGE.CFP","ESDATE_RANGE.SSFYUTD","ESDATE_RANGE.SFYTEFP","ESDATE_RANGE.PFP","ESDATE_RANGE.SLFPUTD","ESDATE_RANGE.SFYULFP"]);E=[{caption:"=",value:"EQ"},{caption:"<>",value:"NE"},{caption:"<",value:"LT"},{caption:"<=",value:"LE"},{caption:">",value:"GT"},{caption:">=",value:"GE"},{caption:"[]",value:"RANGE"},{caption:"Κενό",value:"NULL"},{caption:"Μη κενό",value:"NOTNULL"}],_.map(E,function(a){a.caption=b["ESCOMPLEX."+a.value]}),D=[{dValue:"0",dType:0,title:b["ESDATE_RANGE.SDR"]},{dValue:"1",dType:1,title:b["ESDATE_RANGE.SD"]},{dValue:"ESDateRange(SpecificDate, #9999/01/01#, SpecificDate, #1753/01/01#)",dType:2,title:b["ESDATE_RANGE.ANY"]},{dValue:"ESDateRange(Day)",dType:3,title:b["ESDATE_RANGE.TODAY"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Day, 0)",dType:4,title:b["ESDATE_RANGE.UTD"]},{dValue:"ESDateRange(Day, 0, SpecificDate, #9999/01/01#)",dType:5,title:b["ESDATE_RANGE.SFTD"]},{dValue:"ESDateRange(Day, -1)",dType:6,title:b["ESDATE_RANGE.YTD"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Day, -1)",dType:7,title:b["ESDATE_RANGE.UTYD"]},{dValue:"ESDateRange(Day, 1)",dType:8,title:b["ESDATE_RANGE.TMR"]},{dValue:"ESDateRange(Day, 1, SpecificDate, #9999/01/01#)",dType:9,title:b["ESDATE_RANGE.SFTR"]},{dValue:"ESDateRange(Week)",dType:10,title:b["ESDATE_RANGE.CW"]},{dValue:"ESDateRange(Week, -1)",dType:11,title:b["ESDATE_RANGE.PW"]},{dValue:"ESDateRange(Week, 1)",dType:12,title:b["ESDATE_RANGE.NW"]},{dValue:"ESDateRange(Month)",dType:13,title:b["ESDATE_RANGE.CM"]},{dValue:"ESDateRange(Month, 0, SpecificDate, #9999/01/01#)",dType:14,title:b["ESDATE_RANGE.SFM"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Month, 0)",dType:15,title:b["ESDATE_RANGE.UEM"]},{dValue:"ESDateRange(Month, -1)",dType:16,title:b["ESDATE_RANGE.PM"]},{dValue:"ESDateRange(Month, -1, SpecificDate, #9999/01/01#)",dType:17,title:b["ESDATE_RANGE.SFLM"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Month, -1)",dType:18,title:b["ESDATE_RANGE.UELM"]},{dValue:"ESDateRange(Quarter)",dType:19,title:b["ESDATE_RANGE.CQ"]},{dValue:"ESDateRange(Quarter, -1)",dType:20,title:b["ESDATE_RANGE.PQ"]},{dValue:"ESDateRange(SixMonth)",dType:21,title:b["ESDATE_RANGE.CSM"]},{dValue:"ESDateRange(SixMonth, -1)",dType:22,title:b["ESDATE_RANGE.PSM"]},{dValue:"ESDateRange(Year)",dType:23,title:b["ESDATE_RANGE.CY"]
},{dValue:"ESDateRange(Year, -1)",dType:24,title:b["ESDATE_RANGE.PY"]},{dValue:"ESDateRange(FiscalPeriod)",dType:25,title:b["ESDATE_RANGE.CFP"]},{dValue:"ESDateRange(FiscalYear, 0, Day, 0)",dType:26,title:b["ESDATE_RANGE.SSFYUTD"]},{dValue:"ESDateRange(FiscalYear, 0, FiscalPeriod, 0)",dType:27,title:b["ESDATE_RANGE.SFYTEFP"]},{dValue:"ESDateRange(FiscalPeriod, -1)",dType:28,title:b["ESDATE_RANGE.PFP"]},{dValue:"ESDateRange(FiscalPeriod, -1, Day, 0)",dType:29,title:b["ESDATE_RANGE.SLFPUTD"]},{dValue:"ESDateRange(FiscalYear, 0, FiscalPeriod, -1)",dType:30,title:b["ESDATE_RANGE.SFYULFP"]}]});var F=[{id:"el-GR",title:"Ελληνικά (GR)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAE3SURBVHjapJOxSgNBEEDfspsoiSaSIgat5CwsRCT2goqNnb9h4S+olSiWFjZWthYKaiUJaH7A6kRitJEjigiJXsjlzrGJuSJBueQ1y7Izw5vdHSUiDIIC4sBIe42CB3waIL10VHil6VPYXAVg+fAaYhq+/7YrbqxkDZAMGi0WJsY6B/PZFCqmWZ/N9VQW4K32RRGSCrBEpNxX/0pNG4AgCNBadwWsHd/0TMwk4jy/1zp7a2brVBb3r+SXue0zye9dyl+4riuAZQBaBJTrjU7FR7eJ8QNyO+co1W2QGo5hWmG85TiORMVxnNAgf3CByYzjev7/NyeQGDL4H9XQwLbtyAa2bYcGJ7d3TFWbkZ7w6eEeAAN4u6UKlCr9fAVPAWlgEhiNmFwHXhSg24OkIxYIAE8NOs4/AwC7uO3xQbABsAAAAABJRU5ErkJggg=="},{id:"en-US",title:"English (US)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAFuSURBVHjapJM/SEJRGMV/Lx9lWGoENjhkOCVBBUYRUUNZ0aBE2VbQHOLaoBA4GrRGEIoIgdLQ1GASGlTjW2oI4U06GCTRH8yQ2yKKPIdeHbj8uMN37uHjHkkIwX8kAd1AX4N6VAPeZcDi8RyV/f4Z0ul7OtF/dtjRYeD63CYBjuPjW7VQKLKw4CKXe9QwGt3sHF+SRmTAkEzeEAyuEovn8XndxON5vF43sVgOn2+K1/XdtsGuwQG+H54ADDLAxsY0qdQdK8sTJBJ5trZm27hzFdO8Xq/XQZaRAU5PswQCa5ycZNnentfwZXyxPbrVwmf5uXl3HhxciOHhfREOXwqrNahhJ1UqFQE4AZx2+56IRDLCbA6IUOhSw3Kvo+0828bEw5CrZaCqqtArVVUF4JQBSqNzmIwmRPXrd7/P2EOp+tHagaIouhMoitJMUCtPLpH5WxVqEmAB7EC/zuE3oCgBhkaRDDoN6kBN+m+dfwYAI5QcdaFOn+AAAAAASUVORK5CYII="},{id:"ro-RO",title:"Românesc (RO)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAFTSURBVHjapJM9TgMxEEafs5sgSEgEBUJwBAQNJ+AaVNyJI0BLRc8NEIgaQVIAEgKym0Ra/+x6KIhiO9BEWBpZn2w/fx7PKBHhP0MBHaA3n1cZFpjlwODk7PJ9efXm/CLRb6e9X4S966udHOg2jef4YDddzY4SuXa4HpkWzP0DQDcHMusaJjPDZ1GFE34IyOKQG3UDe3sLcQ4gywGMdYwnmvFEB4AUiQNf1EG0WtTGAJADVJXho6gop4bFr0ixsAvgyyYYAlylY0DF46ihnJroyqfEgXseBAP9PlWeBYDWGslzfFITPk1qE7S4Gu1sBDCGjA28jwASAwR80Kp2mJ8k0gIwusJ7Qc1frRbfFYUKIV7QNkqitZaOFzrtLKrRpcLstIMf8RgbnmBFPNOvYbL/9q5M9Gvp/yxnBQyAfWBzxV6YAi8KyOaNlK0IaACr/tvO3wMAJOGiBWzsFlIAAAAASUVORK5CYII="},{id:"bg-BG",title:"Bulgară (BG)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAADmSURBVHjapJM9TsQwEIW/SeIsIUCklaBBXAWuxFnoqDkOHRegQEgIpAUWlMTD2kNBoixdfl4zcvG+8dhvxMxYIgFy4KirU6TAdwZUZvY6q7vIWQKUCyYoEyBdAEgTgBDCZGfvyQCu7q45rdZsfY1hey8s/869qlXJ2+dmADSt59Fe2Go9qvtJfkjqbR9Qk7gV0eIowC7u0NYPgNubey5cTmyaUYCkKHj6US57QKuKZQ5ERgHMjFZ1uIH3Hg4KxLlxXxDjn6cDaDDj4eN9Tg5UgAo4B44nmr+AZ+mSmM9IZABUlq7z7wChM1nCssShPAAAAABJRU5ErkJggg=="}];m.prototype.getSections=function(){var a=this.ps;return a&&a.Lines?_.groupBy(a.Lines,"Category_Code"):[]};var G={6:[0,1,2,3,6,8,10,11,12,13,16,19,20,21,22,23,24],20:[0,1,25,26,27,28,29,30]},H=function(a){if(!a||!a.dRange)return"";var b=new Date,c=_.find(D,{dValue:a.dRange});if(!c)return"";var d="el-GR",e=I;switch(e&&e.connectionModel&&e.connectionModel.LangID&&(d=e.connectionModel.LangID),c.dType){case 0:if(!angular.isDate(a.fromD)&&!angular.isDate(a.toD))return"";var f="";angular.isDate(a.fromD)&&(f=a.fromD.toLocaleDateString(d)),f+=" - ";var g="";return angular.isDate(a.toD)&&(g=a.toD.toLocaleDateString(d)),f+=g;case 1:return angular.isDate(a.fromD)?a.fromD.toLocaleDateString(d):"";case 2:return"";case 3:return b.toLocaleDateString(d);case 4:return"-> "+b.toLocaleDateString(d);case 5:return b.toLocaleDateString(d)+" ->";case 6:return b.setDate(b.getDate()-1),b.toLocaleDateString(d);case 7:return b.setDate(b.getDate()-1),b.toLocaleDateString(d)+" ->";case 8:return b.setDate(b.getDate()+1),b.toLocaleDateString(d);case 9:return b.setDate(b.getDate()+1),b.toLocaleDateString(d)+" ->";case 10:var h=b.getDay(),i=0==h?6:h-1,j=new Date(b),e=new Date(b);return j.setDate(b.getDate()-i),e.setDate(j.getDate()+6),j.toLocaleDateString(d)+" - "+e.toLocaleDateString(d);case 11:b.setDate(b.getDate()-7);var h=b.getDay(),i=0==h?6:h-1,j=new Date(b),e=new Date(b);return j.setDate(b.getDate()-i),e.setDate(j.getDate()+6),j.toLocaleDateString(d)+" - "+e.toLocaleDateString(d);case 12:b.setDate(b.getDate()+7);var h=b.getDay(),i=0==h?6:h-1,j=new Date(b),e=new Date(b);return j.setDate(b.getDate()-i),e.setDate(j.getDate()+6),j.toLocaleDateString(d)+" - "+e.toLocaleDateString(d);case 13:b.setDate(1);var j=new Date(b.getFullYear(),b.getMonth()+1,0);return b.toLocaleDateString(d)+" - "+j.toLocaleDateString(d);case 14:return b.setDate(1),b.toLocaleDateString(d)+" ->";case 15:var j=new Date(b.getFullYear(),b.getMonth()+1,0);return"-> "+j.toLocaleDateString(d);case 16:var j=new Date(b.getFullYear(),b.getMonth()-1,1),e=new Date(b.getFullYear(),b.getMonth(),0);return j.toLocaleDateString(d)+" - "+e.toLocaleDateString(d);case 17:var j=new Date(b.getFullYear(),b.getMonth()-1,1);return j.toLocaleDateString(d)+" ->";case 18:var j=new Date(b.getFullYear(),b.getMonth(),0);return"-> "+j.toLocaleDateString(d);case 19:var k=b.getMonth(),l=k%3,j=new Date(b.getFullYear(),k-l,1),e=new Date(b.getFullYear(),k+(3-l),0);return j.toLocaleDateString(d)+" -> "+e.toLocaleDateString(d);case 20:var k=b.getMonth(),l=k%3,e=new Date(b.getFullYear(),k-l,0),j=new Date(b.getFullYear(),e.getMonth()-2,1);return j.toLocaleDateString(d)+" -> "+e.toLocaleDateString(d);case 21:var j=new Date(b.getFullYear(),k>=6?6:0,1),e=new Date(b.getFullYear(),k>=6?11:5,k>=6?31:30);return j.toLocaleDateString(d)+" -> "+e.toLocaleDateString(d);case 22:var j,e,m=b.getFullYear();return k>=6?(j=new Date(m,0,1),e=new Date(m,5,30)):(j=new Date(m-1,6,1),e=new Date(m-1,11,31)),j.toLocaleDateString(d)+" -> "+e.toLocaleDateString(d);case 23:var m=b.getFullYear(),j=new Date(m,0,1),e=new Date(m,11,31);return j.toLocaleDateString(d)+" -> "+e.toLocaleDateString(d);case 24:var m=b.getFullYear()-1,j=new Date(m,0,1),e=new Date(m,11,31);return j.toLocaleDateString(d)+" -> "+e.toLocaleDateString(d);default:return c.title}};s.prototype.getExecuteVal=function(){return this.paramValue},s.prototype.clone=function(a){return new s(a,this.pValue(),this.enumList)},s.prototype.pValue=function(a){return arguments&&0!=arguments.length?this.paramValue===arguments[0]?!1:(this.paramValue=arguments[0],!0):this.paramValue},s.prototype.strVal=function(){var a=this.enumList;if(!a||0==a.length)return this.paramValue?this.paramValue.toString():"";if(!this.paramValue)return"";var b;b=angular.isArray(this.paramValue)?this.paramValue:[this.paramValue];var c=_.reduce(b,function(b,c){var d=_.find(a,{value:c});return b+(d?d.text:c.toString())+" + "},"");return c.substring(0,c.lastIndexOf(" + "))},t.prototype=Object.create(s.prototype),t.prototype.clone=function(a){return new t(a,this.pValue())},t.prototype.strVal=function(){var b=0;b=b.toString();var c=this.paramValue.value?this.paramValue.value.toString():b,d=this.paramValue.valueTo?this.paramValue.valueTo.toString():b;switch(this.paramValue.oper){case"RANGE":var e=a.instant(["ESCOMPLEX.FROM","ESCOMPLEX.TO"]);return e["ESCOMPLEX.FROM"]+c+e["ESCOMPLEX.TO"]+d;case"NULL":return a.instant("ESCOMPLEX.NULL");case"NOTNULL":return a.instant("ESCOMPLEX.NOTNULL");default:return this.paramValue.oper.toString()+" "+c}},t.prototype.getExecuteVal=function(){switch(this.paramValue.value=this.paramValue.value||0,this.paramValue.valueTo=this.paramValue.valueTo||0,this.paramValue.oper){case"RANGE":return"ESNumeric("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESNumeric("+this.paramValue.oper+", '0')";default:return"ESNumeric("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},u.prototype=Object.create(s.prototype),u.prototype.clone=function(a){return new u(a,this.pValue())},u.prototype.strVal=function(){var b=this.paramValue.value?this.paramValue.value.toString():"",c=this.paramValue.valueTo?this.paramValue.valueTo.toString():"";switch(this.paramValue.oper){case"RANGE":var d=a.instant(["ESCOMPLEX.FROM","ESCOMPLEX.TO"]);return d["ESCOMPLEX.FROM"]+b+d["ESCOMPLEX.TO"]+c;case"NULL":return a.instant("ESCOMPLEX.NULL");case"NOTNULL":return a.instant("ESCOMPLEX.NOTNULL");default:return this.paramValue.oper.toString()+" "+b}},u.prototype.getExecuteVal=function(){switch(this.paramValue.oper){case"EQ":return this.paramValue.value;case"RANGE":return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESString("+this.paramValue.oper+", '')";default:return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},v.prototype=Object.create(s.prototype),v.prototype.clone=function(a){return new v(a,this.pValue())},v.prototype.strVal=function(){return H(this.paramValue)},v.prototype.getExecuteVal=function(){var a=this.paramValue.dRange;if("0"==a||"1"==a){var b="#1753/01/01#",c="#9999/01/01#",d=!0,e=moment(this.paramValue.fromD);e.isValid()&&(d=!1,b=e.format("YYYY/MM/DD"));var f=moment(this.paramValue.toD);return f.isValid()&&(d=!1,c=f.format("YYYY/MM/DD")),"0"==a||d?"ESDateRange(SpecificDate, #"+b+"#, SpecificDate, #"+c+"#)":"ESDateRange(SpecificDate, #"+b+"#)"}return this.paramValue.dRange},w.prototype.merge=function(a){var b=this;if(a)for(var c in a){if(!a[c]||!a[c]instanceof s)throw new Error("Invalid parameter type in merge function in paramvalues");b.hasOwnProperty(c)&&b[c]instanceof s?b[c].enumList=a[c].enumList:b[c]=a[c]}return this},w.prototype.setParamValues=function(a){var b=this;for(var c in b)b.hasOwnProperty(c)&&delete b[c];a&&_.isArray(a)&&0!=a.length&&a.forEach(function(a,c,d){b[a.paramCode]=a})},w.prototype.getExecuteVals=function(){var a=this,b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];(d.paramValue||angular.isNumber(d.paramValue)&&0==d.paramValue)&&(b[d.paramCode]=d.getExecuteVal())}return b};var I={hostUrl:"",connectionModel:null,setWebApiToken:function(a,b){a&&angular.isString(a)&&(I.connectionModel?a!==I.connectionModel.WebApiToken&&(I.connectionModel.WebApiToken=a):(I.connectionModel={},I.connectionModel.WebApiToken=a))},getWebApiToken:function(){var a=B(y());return a},setModel:z,getModel:y};C.prototype.startTime=function(){return this.startTime=(new Date).getTime(),this},C.prototype.endTime=function(){return this.endTime=(new Date).getTime(),this},C.prototype.send=function(){var a=this.endTime-this.startTime,b=x();return b?(b.registerTiming({timingCategory:this.category,timingVar:this.variable,timingValue:a,timingLabel:this.label}),this):void 0};var J=function(){var a=!1;return function(b,c){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}();return{esConvertGIDtoId:k,esDetectMobileBrowsers:function(){return J},esConvertIDtoGID:l,rgbToHex:o,getVersion:function(){return d},esSupportedLanguages:F,suggestESLanguageID:j,getMimeTypeForExt:function(a,b){if(!b)return"";var c=b.split("."),d=c[c.length-1].toLowerCase();if(!d)return"";var e=_.find(a,function(a){return-1!=a.extension.indexOf(d)});return e?e.mime:""},getExtensionsForMimeType:function(a,b){if(!b)return[];b=b.toLowerCase();var c=_.find(mimelist,function(a){return a.mime==b});return c?c.extension:[]},getGA:x,setWebApiToken:I.setWebApiToken,getWebApiToken:function(){return I.getWebApiToken()},isAuthenticated:function(){return y(),!!I.connectionModel},getClientSession:function(){return I},getUserMessage:A,getESUISettings:function(){return e},ESPublicQueryDef:p,ESMultiZoomDef:q,ESPQOptions:r,ESParamValues:w,ESParamVal:s,ESNumericParamVal:t,ESStringParamVal:u,ESDateParamVal:v,getesDateRangeOptions:function(a){if(!a||!G[a])return D;var b=G[a];if(!_.isArray(b)||0==b.length)return D;var c,d=[];for(c=0;c<b.length;c++)d[c]=D[b[c]];return d},getesComplexParamFunctionOptions:function(){return E},sessionClosed:function(){I.setModel(null);try{h.clear()}catch(a){}},trackTimer:function(a,b,c){return new C(a,b,c)},sessionOpened:function(a,b){try{try{h.clear()}catch(c){}a.Model.LangID=a.Model.LangID||b.LangID,a.Model.LangID=a.Model.LangID||"el-GR",a.Model.BranchID=a.Model.BranchID||b.BranchID||"-",I.setModel(a.Model);var d=x();angular.isDefined(d)&&d.registerEventTrack({category:"AUTH",action:"LOGIN",label:a.Model.GID}),f.info("LOGIN User ",a.Model.Name)}catch(e){throw f.error(e),e}}}}])}(),function(){"use strict";var a=angular.module("es.Services.Web");a.factory("esStackTrace",function(){var a;try{a=printStackTrace}catch(b){a=StackTrace}return{print:a}}),a.provider("$log",function(){function a(){return log4javascript.getLogger("esLogger")}function b(a){d(new log4javascript.BrowserConsoleAppender);var b=angular.isDefined(a)&&a;b&&d(new log4javascript.PopUpAppender)}function c(a,b){if(f){i&&a&&a.connectionModel&&(i.setCustomField("userId",a.connectionModel.UserID),i.setCustomField("branchId",a.connectionModel.BranchID),i.setCustomField("langId",a.connectionModel.LangID));var c=f.getHeaders();if(c){var d,e=-1;for(d=0;d<c.length;d++)if("Authorization"==c[d].name){e=d;break}-1!=e&&c.splice(e,1)}b&&""!=b&&f.addHeader("Authorization",b)}}function d(a){return-1==e.indexOf(a)?(e.push(a),!0):!1}var e=[],f=null,g=null,h=log4javascript.Level.ALL,i=null;return{setLevel:function(a){h=a,g&&g.setLevel(h)},getLevel:function(){return h},getCurrentLevel:function(){return g?g.getEffectiveLevel():log4javascript.Level.OFF},addAppender:d,addDefaultAppenders:b,addESWebApiAppender:function(a,b){var c=a+"api/rpc/EventLog/";return f=new log4javascript.AjaxAppender(c,!1),f.setSendAllOnUnload(!0),i=new log4javascript.JsonLayout,i.setCustomField("subscriptionId",b),f.setLayout(i),f.setWaitForResponse(!0),f.setBatchSize(100),f.setTimed(!0),f.setTimerInterval(6e4),f.addHeader("Content-Type","application/json"),f.setRequestSuccessCallback(function(a){console.log("ES Logger, BATCH of logs upoloaded",a.responseURL,a.status)}),f.setFailCallback(function(a){console.error("Failed to POST Logs to the server",a)}),d(f)},$get:["esMessaging",function(d){try{g=a(),g.setLevel(h),0==e.length&&b();var i=0;for(i=0;i<e.length;i++)g.addAppender(e[i]);return d.subscribe("AUTH_CHANGED",function(a,b){c(a,b)}),g.sendAll=function(){try{f&&f.sendAll()}catch(a){}},console.info("ES Logger started"),g}catch(j){return console.log("Error in starting entersoft logger",j),$log}}]}}),a.provider("$exceptionHandler",function(){var a={pushToServer:!1,logServer:""};return{getSettings:function(){return a},setPushToServer:function(b){a.pushToServer=b},setLogServer:function(b){a.logServer=b},$get:["$log","$window","esStackTrace","$injector",function(b,c,d,e){function f(f,g){var h,i,j;try{h=f.toString(),i=d.print({e:f}),j={errorUrl:c.location.href,errorMessage:h,stackTrace:i,cause:g||""},b.error(JSON.stringify(j,null,"	"))}catch(k){console.log(arguments)}if(a.pushToServer)try{var l=e.get("esWebApi");l.registerException(j,a.logServer)}catch(k){b.warn("ES Error in registerException on store "+a.logServer),b.error(k)}}return f}]}})}(),function(){"use strict";function doChangeLanguage(a,b){if(b=b||"el-GR",a.use(b.split("-")[0]),kendo){kendo.culture(b);var c=window.ESDBG?"bower_components/kendo-ui/js/messages/kendo.messages.":"//kendo.cdn.telerik.com/"+kendo.version+"/js/messages/kendo.messages.";"el-GR"==b&&(b="en-US"),$.getScript(c+b+".min.js",function(){})}}function ESMasterDetailGridRelation(a,b,c,d){this.relationID=a,this.detailDataSource=b,this.detailParams=c,this.detailParamCode=d||"ISUDGID"}function ESRequeryDetailGrids(){this.registeredRelations=[]}function convertPQRowsToMapRows(a,b){if(!a)return a;if(angular.isArray(a)&&0==a.length)return a;var c=_.map(a,function(a){var b={id:a.GID,longitude:a.Longitude||a.longitude,latitude:a.Latitude||a.latitude,esTempl:a.esTempl,esOptions:{title:a.esTitle,label:a.esLabel,icon:a.esIcon},esObj:a};return b});return _.filter(c,function(a){return 0!=a.longitude&&0!=a.latitude})}var esWEBUI=angular.module("es.Web.UI",["ngAnimate","ui.bootstrap","ngSanitize","pascalprecht.translate"]);esWEBUI.run(["$translate","esMessaging",function(a,b){b.subscribe("AUTH_CHANGED",function(b,c){var d=b&&b.connectionModel&&b.connectionModel.LangID?b.connectionModel.LangID:"el-GR";doChangeLanguage(a,d)})}]),ESRequeryDetailGrids.prototype.addDetailRelation=function(a){if(!(a&&a instanceof ESMasterDetailGridRelation))throw"relInfo parameter is null or is not of type ESMasterDetailGridRelation";if(!a.relationID)throw"The parameter does not contain relationID or is null/emptystring/undefined";var b=a.relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.relationID.toLowerCase()==b});return 0>c?this.registeredRelations.push(a):this.registeredRelations[c]=a,this},ESRequeryDetailGrids.prototype.getDetailRelation=function(a){if(!relationID)throw"relationID is null/emptystring/undefined";var b=relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.toLowerCase()==b});return 0>c?null:this.registeredRelations[c]},ESRequeryDetailGrids.prototype.removeDetailRelation=function(a){if(!relationID)throw"relationID is null/emptystring/undefined";var b=relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.toLowerCase()==b});return 0>c?!1:(this.registeredRelations=this.registeredRelations.splice(c,1),!0)},esWEBUI.filter("esTrustHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),esWEBUI.filter("esParamTypeMapper",function(){var a=function(a){if(!a)return"";var b=a.parameterType.toLowerCase();if(0==b.indexOf("entersoft.framework.platform.esdaterange, queryprocess"))return"esParamDateRange";if(0==b.indexOf("entersoft.framework.platform.esnumeric"))return"esParamAdvancedNumeric";if(0==b.indexOf("entersoft.framework.platform.esstring, queryprocess"))return"esParamAdvancedString";if(0==b.indexOf("system.string, mscorlib"))switch(a.controlType){case 1:return"esParamNumeric";case 2:return"esParamNumeric"}return a.enumList&&a.enumList.length>1?a.multiValued||a.enumOptionAll?"esParamMultiEnum":"esParamEnum":a.isInvestigateZoom()?a.multiValued?"esParamMultiZoom":"esParamZoom":a.isInvestigateEntity()?"esParamInv":"esParamText"};return a}).directive("esPositiveInteger",["$parse",function(a){var b=/^\+?\d+$/;return{require:"ngModel",restrict:"A",link:function(c,d,e,f){var g=!1;if(angular.isDefined(e.esPositiveInteger))try{g=a(e.esPositiveInteger)(c)}catch(h){}f.$validators.esPositiveInteger=function(a,c){return(f.$isEmpty(a)||g?0>a:0>=a)?!1:b.test(c)?!0:!1}}}}]).directive("esLogin",["$translate","$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize",function(a,b,c,d,e,f,g){return{restrict:"AE",scope:{esShowSubscription:"=",esShowBridge:"=",esCredentials:"=",esShowStickySession:"=",esOnSuccess:"&"},template:"<div ng-include src=\"'src/partials/esLogin.html'\"></div>",link:function(b,c,d){var e=function(){if(b.esCredentials.LangID){var c=b.esCredentials.LangID;doChangeLanguage(a,c)}};if(b.esGlobals=f,b.esLangOptions={dataSource:f.esSupportedLanguages,dataTextField:"title",dataValueField:"id",change:e,valuePrimitive:!0,autoBind:!0,valueTemplate:"<img ng-src={{dataItem.icon}}></img><span>{{dataItem.title}}</span>",template:"<img ng-src={{dataItem.icon}}></img><span>{{dataItem.title}}</span>"},b.esCredentials.LangID){var g=b.esCredentials.LangID;doChangeLanguage(a,g)}}}}]).directive("esPropertyQuestion",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esQuestion:"=",esPsDef:"=",esPsVal:"="},template:"<div ng-include src=\"'src/partials/esSurvey/esPropertyQuestion_'+esQuestion.PType+'.html'\"></div>",link:function(a,b,c){a.esGlobals=e;var f=a.esQuestion;f&&f.PArg&&7==f.PType&&(a[f.PArg+"_DS"]=d.getZoomDataSource(f.PArg)),a.openCalendar=function(b){a.calendarStatus.opened=!0},a.calendarStatus={opened:!1},a.calendarFormat="dd-MMMM-yyyy",a.getScale=function(a){return!a||isNaN(a)?[]:_.range(1,Math.abs(parseInt(a))+1)},a.getChoicesOfQuestion=function(){return a.esQuestion&&a.esQuestion.PArg&&a.esPsDef&&a.esPsDef.Choices?_.sortBy(_.filter(a.esPsDef.Choices,{ChoiceCode:a.esQuestion.PArg}),"OrderPriority"):[]}}}}]),esWEBUI.filter("esPQDSToesMapDS",function(){return convertPQRowsToMapRows}).directive("esMapPq",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize","$timeout","uiGmapGoogleMapApi",function(a,b,c,d,e,f,g,h){return{restrict:"AE",replace:!0,scope:{esPanelOpen:"=?",esMapOptions:"=",esPqDef:"=",esShowWindow:"=",esTypeOptions:"=",esType:"=",esMapControl:"=",esHighLight:"=",esClick:"&?"},template:"<div ng-include src=\"'src/partials/esMapPQ.html'\"></div>",link:function(b,e,f){b.mapDS=new kendo.data.ObservableArray([]),b.esMapControl||(b.esMapControl={}),angular.isFunction(b.esClick)||(b.esClick=d.onMapClick),h.then(function(b){a.info("Google maps ver = "+b.version)}),b.esType||(b.esType="standard"),b.esToggleData="Map",b.executePQ=function(){b.esPqDef.esGridOptions.autoBind=!0,b.esPqDef.esGridOptions.change||(b.esPqDef.esGridOptions.change=function(a){var c=this.select();if(c&&1==c.length){var d=this.dataItem(c[0]).GID;d&&g(function(){b.esHighLight=d})}},b.esPqDef.esGridOptions.reBind+=1),c.fetchPublicQuery(b.esPqDef).then(function(a){b.mapDS=new kendo.data.ObservableArray(a.data.Rows)})}}}}]).directive("esMapMarkers",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize","$timeout",function(a,b,c,d,e,f,g){return{restrict:"AE",replace:!0,scope:{esMarkers:"=?",esRows:"=?",esPqInfo:"=",esShowWindow:"=?",esTypeOptions:"=?",esType:"=?",esHighLight:"=?",esClick:"&?"},template:"<div ng-include src=\"'src/partials/esMapMarkers.html'\"></div>",link:function(a,b,c){if(a.$watch("esHighLight",function(b){var c=a.esMarkers;if(c&&(_.map(c,function(a){a.esOptions.animation=0}),b)){var d=_.find(c,function(a){return a.id==b});d&&(d.esOptions.animation=1)}}),c.esMarkers&&c.esRows)throw new Error("Only one of the esMarkers or esRows must be specified, not both");a.esType||(a.esType="standard"),a.esTypeOptions||(a.esTypeOptions={title:"cluster",gridSize:60,ignoreHidden:!0,minimumClusterSize:2}),a.esInfoWindowOptions={disableAutoPan:!0},c.esRows&&a.$watch("esRows",function(b){a.esMarkers=convertPQRowsToMapRows(b,a.esClick)})}}}]).directive("esSurvey",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esSectionIdx:"=",esPsDef:"=",esPsVal:"="},template:"<div ng-include src=\"'src/partials/esSurvey/esSurvey.html'\"></div>",link:function(a,b,c){a.esGlobals=e,a.isIntroduction=function(){return a.esSectionIdx<0},a.isLast=function(){return a.esPsDef&&a.esPsDef.Sections?a.esSectionIdx==a.esPsDef.Sections.length-1:!0},a.saveAndComplete=function(){},a.getQuestionsofSection=function(){if(!a.esPsDef||!a.esPsDef.Sections||a.esSectionIdx<0||a.esSectionId>=a.esPsDef.Sections.length)return[];var b=a.esPsDef.Sections[a.esSectionIdx].Code;return b?_.sortBy(_.filter(a.esPsDef.Lines,{Category_Code:b}),"SeqNum"):[]},a.progress=function(){return a.esSectionIdx<0||!a.esPsDef||!a.esPsDef.Sections||!a.esPsDef.Sections.length?0:Math.round((a.esSectionIdx+1)/a.esPsDef.Sections.length*100)},a.advanceStep=function(){a.isLast()||(a.esSectionIdx+=1)},a.backStep=function(){a.isIntroduction()||(a.esSectionIdx-=1)}}}}]).directive("esChecklistModel",["$parse","$compile",function(a,b){function c(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b))return!0;return!1}function d(a,b,d){return a=angular.isArray(a)?a:[],c(a,b,d)||a.push(b),a}function e(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b)){a.splice(d,1);break}return a}function f(f,g,h){function i(){return h.esChecklistValue?a(h.esChecklistValue)(f.$parent):h.value}function j(a,b){var c=m(f.$parent);angular.isFunction(m.assign)&&(b===!0?m.assign(f.$parent,d(c,a,q)):m.assign(f.$parent,e(c,a,q)))}function k(a,b){return o&&o(f)===!1?void j(i(),p(f)):void p.assign(f,c(a,i(),q))}var l=h.esChecklistModel;h.$set("esChecklistModel",null),b(g)(f),h.$set("esChecklistModel",l);var m=a(l),n=a(h.checklistChange),o=a(h.checklistBeforeChange),p=a(h.ngModel),q=angular.equals;if(h.hasOwnProperty("checklistComparator"))if("."==h.checklistComparator[0]){var r=h.checklistComparator.substring(1);q=function(a,b){return a[r]===b[r]}}else q=a(h.checklistComparator)(f.$parent);f.$watch(h.ngModel,function(a,b){if(a!==b){if(o&&o(f)===!1)return void p.assign(f,c(m(f.$parent),i(),q));j(i(),a),n&&n(f)}}),f.$watch(i,function(a,b){if(a!=b&&angular.isDefined(b)&&f[h.ngModel]===!0){var c=m(f.$parent);m.assign(f.$parent,e(c,b,q)),m.assign(f.$parent,d(c,a,q))}}),angular.isFunction(f.$parent.$watchCollection)?f.$parent.$watchCollection(l,k):f.$parent.$watch(l,k,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(a,b){if(!b.esChecklistValue&&!b.value)throw"You should provide `value` or `checklist-value`.";return b.ngModel||b.$set("ngModel","checked"),f}}}]).directive("esGrid",["$log","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esExecuteParams:"=",esGridOptions:"=?",esPostGridOptions:"=?",esPQOptions:"=?",esDataSource:"="},templateUrl:function(a,b){return"src/partials/esGrid.html"},link:function(c,e,f){if(c.esGridRun=function(){c.esGridOptions&&c.esGridOptions.dataSource&&(c.esPQOptions&&!c.esPQOptions.ServerPaging?(c.esGridOptions.dataSource.read(),c.esGridOptions.dataSource.page(1)):c.esGridOptions.dataSource.page(1))},c.downloadBlob=function(c){b.fetchES00DocumentBlobDataByGID(c).then(function(a){var b=a.data,c=a.headers()["content-type"],d=new Blob([b],{type:c}),e=URL.createObjectURL(d);window.open(e)})["catch"](function(b){a.error("2nd error = "+JSON.stringify(b))})},c.esGridPrint=function(){},!c.esGridOptions&&!f.esGridOptions){if(!c.esGroupId||!c.esFilterId)throw"esGridOptions NOT defined. In order to dynamically get the options you must set GroupID and FilterID for esgrid to work";b.fetchPublicQueryInfo(c.esGroupId,c.esFilterId).then(function(a){var b=a.data,e=d.winGridInfoToESGridInfo(c.esGroupId,c.esFilterId,b);c.esGridOptions=d.esGridInfoToKInfo(c.esGroupId,c.esFilterId,c.esExecuteParams,e,c.esPQOptions),c.esPostGridOptions&&angular.merge(c.esGridOptions,c.esPostGridOptions)})}}}}]).directive("esGaugePq",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esPqDef:"="},templateUrl:function(a,b){return"src/partials/esGaugePQ.html"},link:function(a,b,d){c.fetchPublicQuery(a.esPqDef).then(function(b){b.data.Rows&&b.data.Rows.length&&(a.esRow=b.data.Rows[0])},function(a){})}}}]).directive("esGauge",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){function g(a,b){var c=0,d=100,e=[];b&&b.Ranges&&b.Ranges.length&&(c=_.min(b.Ranges,function(a){return a.MinValue}).MinValue,d=_.max(b.Ranges,function(a){return a.MaxValue}).MaxValue,e=_.map(b.Ranges,function(a){var b={from:a.MinValue,to:a.MaxValue};return a.ColorARGB&&(b.color=f.rgbToHex(a.ColorARGB)),b})),a.esScaleOptions={min:c,max:d,ranges:e,vertical:!1}}return{restrict:"AE",scope:{esRow:"=",esGaugeOptions:"=?"},templateUrl:function(a,b){return"src/partials/esGauge.html"},link:function(a,b,d){var e=void 0;a.esRow&&(a.esGaugeType=(a.esRow.GType||"radial").toLowerCase(),a.esRow.GScale?c.fetchESScale(a.esRow.GScale).then(function(b){e=b,g(a,e,a.esRow)},function(a){}):g(a,void 0))}}}]).directive("esChart",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esPanelOpen:"=?",esPqDef:"=?",esChartOptions:"=",esLocalData:"=?"},templateUrl:function(a,b){return"src/partials/esChartPQ.html"},link:function(a,c,d){a.esLocalData||d.esLocalData?a.esChartDataSource={data:a.esLocalData}:a.esChartDataSource=e.getPQDataSource(a.esPqDef),a.esChartOptions.dataSource=a.esChartDataSource,a.esChartOptions&&!a.esChartOptions.dataBound&&(a.esChartOptions.dataBound=function(a){a&&a.sender&&kendo.ui.progress(a.sender.element.parent(),!1)}),a.executePQ=function(){a.isOpen=!1,a.esChartDataSource&&(a.esChartCtrl&&kendo.ui.progress(a.esChartCtrl.element.parent(),!0),a.esChartDataSource.read())},angular.element(b).bind("resize",function(){kendo.resize(angular.element(".eschart-wrapper"))})}}}]).directive("esLocalGrid",["$log","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esGridOptions:"=",esDataSource:"="},templateUrl:function(a,b){return"src/partials/esLocalGrid.html"},link:function(c,d,e){c.esGridRun=function(){c.esGridCtrl&&c.esGridCtrl.dataSource.read()},c.downloadBlob=function(c){b.fetchES00DocumentBlobDataByGID(c).then(function(a){var b=a.data,c=a.headers()["content-type"],d=new Blob([b],{type:c}),e=URL.createObjectURL(d);window.open(e)})["catch"](function(b){a.error("2nd error = "+JSON.stringify(b))})}}}}]).directive("es00DocumentsDetail",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","esCache",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esDocumentGridOptions:"=?",esMasterRowField:"=?",esIsudgid:"=?"},template:"<div ng-include src=\"'src/partials/es00DocumentsDetail.html'\"></div>",link:function(b,g,h){function i(a,c,f,g){var h=a,i=d.winGridInfoToESGridInfo(f,g,h),j=new e.ESPQOptions(1,-1,!0,!1);a=d.esGridInfoToKInfo(f,g,{},i,j),a.autoBind=!0,a.toolbar=null,a.groupable=!1,a.dataSource=c;var k=_.find(i.columns,{field:"Code"});k&&(k.template='<button class="btn btn-primary" ng-click="downloadBlob(dataItem.GID)">{{dataItem.Code}}</button>'),b.esDocumentGridOptions=angular.extend(a,b.esDocumentGridOptions)}b.downloadBlob=function(a){},b.$watch("esIsudgid",function(a,c){b.esDocumentGridOptions&&b.esDocumentGridOptions.dataSource&&b.esDocumentGridOptions.dataSource.read();
}),b.esIsudgid||h.esIsudgid||b.esMasterRowField||h.esMasterRowField||(b.esMasterRowField="GID",a.warn("esIsudgid is not specified and esMasterRowField for es00DocumentsDetail directive NOT specified. Assuming GID"));var j=function(){var a="ES00Documents",d="ES00DocumentsDetails",e={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverPaging:!1,pageSize:20,transport:{read:function(a){try{var d=b.esIsudgid?b.esIsudgid:b.$parent.dataItem[b.esMasterRowField];c.fetchES00DocumentsByEntityGID(d).then(function(b){a.success(b)},function(b){a.error(b)})}catch(e){a.success({data:[]})}}},schema:{data:"data",total:"data.length"}},g=new kendo.data.DataSource(e),h=f.getItem("PQI_"+a+"/"+d);h?i(h,g,a,d):c.fetchPublicQueryInfo(a,d).then(function(b){f.setItem("PQI_"+a+"/"+d,b.data),i(b.data,g,a,d)})};j()}}}]).controller("esModalInvestigateCtrl",["$scope","$uibModalInstance","esMessaging","invParams",function(a,b,c,d){a.investigateGridOptions={autoBind:!0,selectable:d.paramDef.multiValued?"multiple, row":"row"},a.invParams=d||{},a.selectedRows=null;var e=function(b,c){return c&&0!=c.length?void(a.selectedRows=_.map(c,function(c){return b.sender.dataItem(c)[a.invParams.paramDef.invSelectedMasterField]})):void(a.selectedRows=null)};b.closed.then(function(){c.unsubscribe(f)});var f=c.subscribe("GRID_ROW_CHANGE",e);a.ok=function(){b.close(a.selectedRows)},a.cancel=function(){b.dismiss("cancel")}}]).directive("esParam",["$log","$uibModal","esWebApi","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esParamDef:"=",esParamVal:"=",esType:"="},template:"<div ng-include src=\"'src/partials/'+esType+'.html'\"></div>",link:function(a,f,g){if(!a.esParamDef)throw"You must set a param";a.esParamDef.isInvestigateEntity()&&(a.onInvestigate=function(){var c=b.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<div ng-include src=\"'src/partials/esInvestigate.html'\"></div>",controller:"esModalInvestigateCtrl",size:"lg",resolve:{invParams:function(){var b=a.esParamVal[a.esParamDef.id].clone("Code");return{paramDef:a.esParamDef,pVals:new e.ESParamValues([b])}}}});c.result.then(function(b){if(b&&0!=b.length){var c=(a.esParamDef.invSelectedMasterField,_.join(b,"\\,"));a.esParamVal[a.esParamDef.id].pValue(c)}})}),a.esGlobals=e,a.esWebUIHelper=d,a.esWebApiService=c,a.esParamDef.isInvestigateZoom()&&(a.esParamLookupDS=d.getZoomDataSource(a.esParamDef.invSelectedMasterTable)),(6==a.esParamDef.controlType||20==a.esParamDef.controlType)&&(a.dateRangeOptions=e.getesDateRangeOptions(a.esParamDef.controlType))}}}]).directive("esWebPq",["$log","esWebApi","esUIHelper","esMessaging","esGlobals","esCache",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esGridOptions:"=?",esForceTitle:"=?",esParamsValues:"=",esPanelOpen:"=?",esPQOptions:"=?",esShowTopPagination:"=",esPostProcessGridOptions:"&"},templateUrl:function(a,b){return"src/partials/esWebPQ.html"},link:function(a,d,g){function h(b){var d=c.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,b);a.esParamsValues&&a.esParamsValues instanceof e.ESParamValues?a.esParamsValues.merge(d.defaultValues):a.esParamsValues=d.defaultValues,a.esParamsDef=d.params;var f=c.esGridInfoToKInfo(a.esGroupId,a.esFilterId,a.esParamsValues,d,a.esPQOptions),g=angular.extend(f,a.esGridOptions);a.esPostProcessGridOptions&&angular.isFunction(a.esPostProcessGridOptions)&&(g=a.esPostProcessGridOptions({arg1:g})||g),a.esGridOptions=g}if(!a.esGroupId||!a.esFilterId)throw"You must set the pair es-group-id and es-filter-id attrs";a.executePQ=function(){a.esGridOptions.dataSource.read()};var i=f.getItem("PQI_"+a.esGroupId+"/"+a.esFilterId);i?h(i):b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId).then(function(b){f.setItem("PQI_"+a.esGroupId+"/"+a.esFilterId,b.data),h(b.data)})}}}]).directive("esParamsPanel",["$translate","$log","esWebApi","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esPanelOpen:"=?",esParamsDef:"=?",esPqInfo:"=?",esParamsValues:"=?",esGroupId:"=?",esFilterId:"=?",esRunClick:"&",esForceTitle:"=?",esRunTitle:"@?",esShowRun:"=?",esLocalDataSource:"=?",esDataSource:"=?"},templateUrl:function(a,b){return"src/partials/esParams.html"},link:function(b,f,g){if(!g.esParamsDef&&!g.esPqInfo&&!(b.esGroupId instanceof e.ESPublicQueryDef||b.esGroupId&&b.esFilterId))throw new Error("You must set either the es-params-def or es-pq-info or the pair es-group-id and es-filter-id attrs");b.esShowRun&&!b.esRunTitle&&a("ESUI.PQ.PARAMS_PANEL_RUN").then(function(a){b.esRunTitle=a}),b.esGroupId instanceof e.ESPublicQueryDef&&!g.esParamsValues&&(b.esParamsValues=b.esGroupId.Params),g.esParamsDef||(g.esPqInfo?b.esParamDef=esPqInfo.params:c.fetchPublicQueryInfo(b.esGroupId,b.esFilterId).then(function(a){var c=d.winGridInfoToESGridInfo(b.esGroupId,b.esFilterId,a.data);if(b.esGroupId instanceof e.ESPublicQueryDef)if(b.esLocalDataSource)b.esGroupId.esGridOptions=d.esGridInfoToLocalKInfo(b.esGroupId.GroupID,b.esGroupId.FilterID,b.esGroupId.Params,c,b.esDataSource);else{var f=new e.ESPQOptions(1,-1,!0,!1);b.esGroupId.esGridOptions=d.esGridInfoToKInfo(b.esGroupId.GroupID,b.esGroupId.FilterID,b.esGroupId.Params,c,f)}b.esParamsValues&&b.esParamsValues instanceof e.ESParamValues?b.esParamsValues.merge(c.defaultValues):b.esParamsValues=c.defaultValues,b.esParamsDef=c.params}))}}}]),esWEBUI.factory("esUIHelper",["$state","$translate","$log","$timeout","esMessaging","esWebApi","esGlobals",function($state,$translate,$log,$timeout,esMessaging,esWebApiService,esGlobals){function esColToKCol(a,b){var c={field:a.field,title:a.title,width:a.width,attributes:a.attributes,columnSet:a.columnSet,values:a.enumValues,dataType:a.dataType,hidden:!a.visible,headerAttributes:{"class":"es-table-header-cell"},template:void 0,footerTemplate:void 0,aggregate:void 0,groupFooterTemplate:void 0};switch(c.aggregate=a.aggregate,a.dataType){case"int32":case"byte":"8"==a.editType&&(c.template=kendo.format('<div align="center"><input type="checkbox" #={0} ? "checked=checked" : "" # disabled="disabled" ></input></div>',a.field));break;case"byte[]":"0"==a.editType&&(c.template="<img src='#:kendo.format('data:image/jpg;base64,{0}', "+a.field+")#'/>");break;case"string":var d=!1;if(b&&b.showCol==a.field&&b.selectedMasterField&&b.selectedState&&$state){var e=$state.get(),f=_.find(e,{name:b.selectedState});if(f){var g=kendo.format("#= ((data.{0}) && (data.{1})) ? ",b.selectedMasterField,a.field),h='kendo.format("<a ui-sref=\\"{2}({PK: \'{0}\'} )\\">{1}</a>", '+b.selectedMasterField+", "+a.field+", '"+b.selectedState+"')";c.template=g+h+kendo.format(" : (data.{0}) #",a.field),d=!0}}if(!d){var i="";-1!=a.field.toLowerCase().indexOf("email")?i="mailto:":(-1!=a.field.toLowerCase().indexOf("tele")||-1!=a.field.toLowerCase().indexOf("mobile"))&&(i="tel:"),i&&(c.template=kendo.format("<a href='{1}#={0}||''#'>#={0}||''#</a>",a.field,i))}break;case"datetime":var j=a.formatString||"d";c.format="{0:"+j+"}";break;default:a.formatString&&""!=a.formatString&&(c.format="{0:"+a.formatString+"}")}if(c.aggregate){c.aggregates=[c.aggregate];var k=a.formatString?"kendo.toString("+c.aggregate+",'"+a.formatString.replace(/#/g,"\\\\#")+"')":c.aggregate;c.footerTemplate="<div style='text-align: right'>#:"+k+"#</div>",c.groupFooterTemplate=c.footerTemplate}return c}function handleChangeGridRow(a){var b=this.select(),c=void 0;if(b&&1==b.length&&(c=this.dataItem(b[0]).GID),c&&this.options.masterDetailRelations){if(!(this.options.masterDetailRelations instanceof ESRequeryDetailGrids))throw"masterDetailRelations should be of type ESRequeryDetailGrids";_.each(this.options.masterDetailRelations.registeredRelations,function(a){a instanceof ESMasterDetailGridRelation&&$timeout(function(){var b=a.detailParams(),d=a.detailDataSource();d&&b&&b[a.detailParamCode]&&b[a.detailParamCode].pValue(c)&&d.read()})})}esMessaging.publish("GRID_ROW_CHANGE",a,b)}function prepareStdZoom(a,b){var c={transport:{read:function(c){var d={};esWebApiService.fetchStdZoom(a,d,b).then(function(a){var b=a.data;-1==b.Count&&(b.Count=b.Rows?b.Rows.length:0),c.success(b)},function(a){c.error(a)})}},schema:{data:"Rows",total:"Count"}};return new kendo.data.DataSource(c)}function prepareWebScroller(a,b,c,d){var e=angular.isFunction(a)?a():a;d&&c?_.map(d,function(a){a.aggregates=c}):d=void 0;var f={aggregate:c,group:d,transport:{requestEnd:function(a){var b=a.response,c=a.type;console.log(c),console.log(b.length)},read:function(a){var b={};a.data&&a.data.page&&a.data.pageSize&&(b.WithCount=!0,b.Page=a.data.page,b.PageSize=a.data.pageSize);var c=e.Params;c instanceof esGlobals.ESParamValues&&(c=c.getExecuteVals()),esWebApiService.fetchPublicQuery(e.GroupID,e.FilterID,b,c).success(function(b){angular.isDefined(b.Rows)||(b.Rows=[],b.Count=0),angular.isDefined(b.Count)||(b.Count=-1),a.success(b)}).error(function(b){$log.error("Error in DataSource ",b),a.error(b)})}},requestStart:function(a){},schema:{data:"Rows",total:"Count"}};return e&&e.SchemaColumns&&e.SchemaColumns.length&&(f.schema.parse=function(a){return _.each(a.Rows,function(a){_.each(e.SchemaColumns,function(b){var c=b.field;a[c]&&"string"==typeof a[c]&&(a[c]=kendo.parseDate(a[c]))})}),a}),b&&angular.extend(f,b),new kendo.data.DataSource(f)}function preparePivotDS(a,b){var c=angular.isFunction(a)?a():a,d={transport:{requestEnd:function(a){var b=a.response,c=a.type;console.log(c),console.log(b.length)},read:function(a){var b={},d=c.Params;d instanceof esGlobals.ESParamValues&&(d=d.getExecuteVals()),esWebApiService.fetchPublicQuery(c.GroupID,c.FilterID,b,d).success(function(b){a.success(b.Rows||[])}).error(function(b){$log.error("Error in DataSource ",b),a.error(b)})}}};return b&&angular.extend(d,b),new kendo.data.PivotDataSource(d)}function esExportToExcel(a){for(var b=a.workbook.sheets[0],c=0;c<b.rows.length;c++){var d=b.rows[c].type;if("group-footer"==d||"footer"==d)for(var e=0;e<b.rows[c].cells.length;e++){var f=b.rows[c].cells[e],g=f.value;g&&angular.isString(g)&&g.startsWith("<div style='text-align: right'>")&&g.endsWith("</div>")&&(f.value=g.replace("<div style='text-align: right'>","").replace("</div>",""),f.hAlign="right",f.bold=!0)}}}function esGridInfoToLocalKInfo(a,b,c,d,e){var f={pageable:{refresh:!0,pageSizes:[20,50,100,kendo.ui.Pager.prototype.options.messages.allPages]},autoBind:!1,sortable:!0,scrollable:!0,selectable:"row",allowCopy:!0,resizable:!0,reorderable:!0,navigatable:!0,noRecords:{template:"<h3><span class='label label-info'>"+kendo.ui.Pager.prototype.options.messages.empty+"</span></h3>"},filterable:!0,groupable:!0,toolbar:["excel"],excel:{allPages:!0,fileName:a+"-"+b+".xlsx",filterable:!0},excelExport:esExportToExcel};return esGlobals.getESUISettings().mobile&&(f.mobile=esGlobals.getESUISettings().mobile),esGlobals.getESUISettings().defaultGridHeight&&(f.height=esGlobals.getESUISettings().defaultGridHeight),f.columns=d.columns,_.map(f.columns,function(a){a.columns?_.map(a.columns,function(a){a.footerTemplate=void 0,a.groupFooterTemplate=void 0}):(a.footerTemplate=void 0,a.groupFooterTemplate=void 0)}),f.selectedMasterField=d.selectedMasterField,f.selectedMasterTable=d.selectedMasterTable,f.columnMenu=!0,e&&(f.dataSource=e),f.reBind=0,f}function esGridInfoToKInfo(a,b,c,d,e){var f=e instanceof esGlobals.ESPQOptions?e:(new esGlobals.ESPQOptions).initFromObj(e),g={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverAggregates:!1,serverPaging:f.ServerPaging,pageSize:f.getPageSizeForUI()},h=_.uniq(_.union([f.getPageSizeForUI()],[20,50,100])).sort(function(a,b){return a-b});h.push(kendo.ui.Pager.prototype.options.messages.allPages);var i={pageable:{refresh:!0,pageSizes:h},autoBind:f.AutoExecute,sortable:!g.serverPaging,scrollable:!0,selectable:"row",allowCopy:!0,resizable:!0,reorderable:!0,navigatable:!0,noRecords:{template:"<h3><span class='label label-info'>"+kendo.ui.Pager.prototype.options.messages.empty+"</span></h3>"},filterable:!g.serverPaging,groupable:!g.serverPaging,toolbar:[{name:"run",text:"Run",template:"<a class='k-button' ng-click=\"esGridRun()\">{{'ESUI.PQ.TOOLBAR_RUN' | translate}}</a>"},"excel"],excel:{allPages:!0,fileName:a+"-"+b+".xlsx",filterable:!0},excelExport:esExportToExcel};esGlobals.getESUISettings().mobile&&(i.mobile=esGlobals.getESUISettings().mobile),esGlobals.getESUISettings().defaultGridHeight&&(i.height=esGlobals.getESUISettings().defaultGridHeight),i.groups=d.groups,i.columns=d.columns,i.selectedMasterField=d.selectedMasterField,i.selectedMasterTable=d.selectedMasterTable,i.columnMenu=!0;var j=_.flatMap(i.columns,function(a){return a.columns?_.filter(a.columns,function(a){return!!a.aggregate}):a.aggregate?[a]:[]});return i.dataSource=prepareWebScroller(function(){return{GroupID:a,FilterID:b,Params:c,SchemaColumns:_.filter(i.columns,{dataType:"datetime"})}},g,j,i.groups),i.change=handleChangeGridRow,i.dataBound=handleChangeGridRow,i.reBind=0,i}function winColToESCol(a,b,c,d){var e,f;angular.isObject(a)?(f=a.GroupID,e=a.FilterID):(f=a,e=b);var g={AA:void 0,field:void 0,title:void 0,width:void 0,visible:void 0,attributes:void 0,enumValues:void 0,formatString:void 0,odsTag:void 0,dataType:void 0,editType:void 0,columnSet:void 0,aggregate:void 0};switch(g.AA=parseInt(d.AA),g.field=d.ColName,g.title=d.Caption,g.odsTag=d.ODSTag,g.columnSet=parseInt(d.ColumnSet),g.dataType=d.DataTypeName?d.DataTypeName.toLowerCase():void 0,g.editType=d.EditType,g.width=parseInt(d.Width),d.AggregateFunction){case"1":g.aggregate="count";break;case"2":g.aggregate="sum";break;case"3":g.aggregate="average";break;case"4":g.aggregate="min";break;case"5":g.aggregate="max"}g.formatString=d.FormatString,g.visible="true"==d.Visible;var h=g.dataType;switch(g.dataType){case"byte":8==g.editType&&(h="boolean-checkbox")}if(g.attributes={"class":"es-grid-cell-"+h},"3"==d.TextAlignment&&(g.attributes.style="text-align: right;"),"5"==d.EditType){var i=_.sortBy(_.filter(c.ValueList,function(a){var b=a.ColName==d.ColName;return b=b&&"undefined"!=typeof a.Value,b=b&&a.fFilterID.toLowerCase()==e}),function(a){return isNaN(a.Value)?null:parseInt(a.Value)}),j=_.map(i,function(a){return{text:a.Caption,value:isNaN(a.Value)?null:parseInt(a.Value)}});j&&j.length&&(g.enumValues=j)}return g}function dateEval(pInfo,expr){function isActualDate(a){return a&&"1753/01/01"!=a&&"9999/01/01"!=a}var SpecificDate="SpecificDate",Month="Month",SixMonth="SixMonth",Week="Week",Year="Year",Quarter="Quarter",Day="Day",FiscalPeriod="FiscalPeriod",FiscalYear="FiscalYear",Bimonthly="Bimonthly",dVal=eval(expr.replace(/#/g,'"')),esdate=new esGlobals.ESDateParamVal(pInfo.id),mD=moment(dVal,"YYYY/MM/DD");if(!dVal.fromType&&!dVal.toType&&!dVal.fromD&&!dVal.toD&&mD.isValid())return esdate.paramValue.dRange="1",esdate.paramValue.fromD=mD.toDate(),esdate;if(dVal.fromType==SpecificDate&&isActualDate(dVal.fromD)&&dVal.toType==SpecificDate&&isActualDate(dVal.toD))return esdate.paramValue.dRange="0",esdate.paramValue.fromD=new Date(dVal.fromD),esdate.paramValue.toD=new Date(dVal.toD),esdate;if(dVal.fromType==SpecificDate&&isActualDate(dVal.fromD))return esdate.paramValue.dRange="1",esdate.paramValue.fromD=new Date(dVal.fromD),esdate;var drOptions=esGlobals.getesDateRangeOptions(),elem=_.find(drOptions,function(a){return a.dValue==expr});if(!angular.isUndefined(elem))return esdate.paramValue.dRange=expr,esdate;var fD=calcActualDate(dVal.fromType,dVal.fromD,!0),tD=calcActualDate(dVal.toType,dVal.toD,!1);return esdate.paramValue.dRange="0",esdate.paramValue.fromD=fD,esdate.paramValue.toD=tD,esdate}function calcActualDate(a,b,c){switch(a){case"Year":return c?(b>0&&(b-=1),moment().add(b,"years").startOf("year").toDate()):moment().add(b,"years").endOf("year").toDate();case"Month":return c?moment().startOf("month").add(b,"months").toDate():moment().endOf("month").add(b,"months").toDate();case"Week":return c?moment().startOf("week").add(1,"days").add(b,"weeks").toDate():moment().endOf("week").add(1,"days").add(b,"weeks").toDate();case"Day":return moment().add(b,"days").toDate();case"Quarter":return c?(b>0&&(b-=1),moment().startOf("quarter").add(b,"quarters").toDate()):moment().endOf("quarter").add(b,"quarters").endOf("quarter").toDate();default:return alert("ESDateRange option NOT Supported. ["+a+", "+b+", "+c+"]. Using Current Month instead"),c?moment().startOf("month").toDate():moment().endOf("month").toDate()}}function esEval(pInfo,expr){var EQ={oper:"EQ",paramID:pInfo.id},GE={oper:"GE",paramID:pInfo.id},GT={oper:"GT",paramID:pInfo.id},LE={oper:"LE",paramID:pInfo.id},LT={oper:"LT",paramID:pInfo.id},NE={oper:"NE",paramID:pInfo.id},RANGE={oper:"RANGE",paramID:pInfo.id},NULL={oper:"NULL",paramID:pInfo.id},NOTNULL={oper:"NOTNULL",paramID:pInfo.id};return eval(expr)}function ESNumeric(a,b,c){var d={value:isNaN(b)?null:parseInt(b),valueTo:isNaN(c)?null:parseInt(c),oper:a.oper||"EQ"};return new esGlobals.ESNumericParamVal(a.paramID,d)}function ESString(a,b,c){var d={value:b,valueTo:c,oper:a.oper||"EQ"};return new esGlobals.ESStringParamVal(a.paramID,d)}function ESDateRange(a,b,c,d){return{fromType:a,fromD:b,toType:c,toD:d}}function createEsParamVal(a){if(!a||!a.id)return null;var b=a.value||[];b=angular.isArray(b)?b:[b];var c=new ESParamInfo;return angular.merge(c,a),b=_.map(b,function(a){return{Value:a}}),getEsParamVal(c,b)}function createESParams(a){if(!a||!angular.isArray(a))return new(new esGlobals.ESParamValues);var b=[];return _.map(a,function(a){var c=createEsParamVal(a);c&&b.push(c)}),new esGlobals.ESParamValues(b)}function getEsParamVal(a,b){var c=a.parameterType.toLowerCase();if(0==c.indexOf("entersoft.framework.platform.esnumeric"))return b&&0!=b.length?esEval(a,b[0].Value):new esGlobals.ESNumericParamVal(a.id,{oper:"EQ",value:0});if(0==c.indexOf("entersoft.framework.platform.esdaterange, queryprocess"))return b&&0!=b.length?dateEval(a,b[0].Value):new esGlobals.ESDateParamVal(a.id,6==a.controlType?null:{dRange:"ESDateRange(FiscalPeriod)",fromD:null,toD:null});if(0==c.indexOf("entersoft.framework.platform.esstring, queryprocess"))return b&&0!=b.length?esEval(a,b[0].Value):new esGlobals.ESStringParamVal(a.id,{oper:"EQ",value:null});if(!b||0==b.length){var d=a.multiValued?[]:null;return new esGlobals.ESParamVal(a.id,d,a.enumList)}var e=_.map(b,function(b){return processStrToken(a,b.Value)});return 1==e.length&&(e=e[0]),new esGlobals.ESParamVal(a.id,e,a.enumList)}function processStrToken(a,b){if(!a)return b;var c=a.parameterType.toLowerCase();if(-1!=c.indexOf("system.byte")||-1!=c.indexOf("system.int"))return parseInt(b);if(a.enumList&&a.enumList.length>1)return parseInt(b);if(!_.startsWith(b,"##("))return b;switch(b.toLowerCase()){case"##(esbranch)":var d=esGlobals.getClientSession();return d&&d.connectionModel?d.connectionModel.BranchID:b;default:return b}}function ESParamInfo(){this.id=void 0,this.aa=void 0,this.caption=void 0,this.toolTip=void 0,this.controlType=void 0,this.parameterType="",this.precision=void 0,this.multiValued=!1,this.visible=void 0,this.required=void 0,this.oDSTag=void 0,this.formatStrng=void 0,this.tags=void 0,this.visibility=void 0,this.invQueryID=void 0,this.invSelectedMasterTable=void 0,this.invSelectedMasterField=void 0,this.invTableMappings=void 0,this.defaultValues=void 0,this.enumOptionAll=void 0,this.enumList=void 0}function ESParamsDefinitions(a,b){this.title=a,this.definitions=b,this.visibleDefinitions=function(){if(!this.definitions)return[];var a=this.definitions;return _.filter(a,{visible:!0})}}function winParamInfoToesParamInfo(a,b){if(!a)return null;var c=new ESParamInfo;c.id=a.ID,c.aa=parseInt(a.AA),c.caption=a.Caption,c.toolTip=a.Tooltip,c.controlType=parseInt(a.ControlType),c.parameterType=a.ParameterType,c.precision=parseInt(a.Precision),c.multiValued="true"==a.MultiValued,c.visible="true"==a.Visible,c.required="true"==a.Required,c.oDSTag=a.ODSTag,c.tags=a.Tags,c.visibility=parseInt(a.Visibility),c.invQueryID=a.InvQueryID,c.invSelectedMasterTable=a.InvSelectedMasterTable,c.invSelectedMasterField=a.InvSelectedMasterField,c.invTableMappings=a.InvTableMappings,c.enumOptionAll=a.EnumOptionAll;var d=_.sortBy(_.map(_.filter(b.EnumItem,function(a){return a.fParamID==c.id&&"undefined"!=typeof a.ID}),function(a){return{text:c.oDSTag?a.Caption.substring(a.Caption.indexOf(".")+1):a.Caption,value:isNaN(a.ID)?null:parseInt(a.ID)}}),"value");c.enumList=d.length?d:void 0;var e=b.DefaultValue;if(e&&angular.isArray(e)){var f=_.filter(e,{fParamID:c.id});c.defaultValues=getEsParamVal(c,f)}else c.defaultValues=getEsParamVal(c,[]);return c}function winGridInfoToESGridInfo(a,b,c){if(!c||!c.LayoutColumn)return null;var d,e;angular.isObject(a)?(e=a.GroupID,d=a.FilterID):(e=a,d=b);var f=d.toLowerCase(),g=_.filter(c.Filter,function(a){return a.ID.toLowerCase()==f});if(!g||1!=g.length)return null;var h={id:void 0,caption:void 0,rootTable:void 0,selectedMasterTable:void 0,selectedMasterField:void 0,columnSets:void 0,columns:void 0,params:void 0,defaultValues:void 0,groups:void 0};h.groups=_.map(_.filter(c.LayoutGroup,function(a){return a.fFilterID.toLowerCase()==f}),function(a){return{field:a.ColName,aa:a.AA,sortOrder:a.SortOrder}}),g=g[0],h.id=g.ID,h.caption=g.Caption,h.rootTable=g.RootTable,h.selectedMasterTable=g.SelectedMasterTable,h.selectedMasterField=g.SelectedMasterField;var i=_.map(_.filter(c.LayoutColumn,function(a){return a.fFilterID.toLowerCase()==f&&"Guid"!=a.DataTypeName}),function(a){return winColToESCol(e,f,c,a)}),j=_.sortBy(i,function(a){return parseInt(a.AA)}),k=_.find(j,function(a){return a.visible&&"string"==a.dataType}),l=_.map(j,function(a){var b=k?{showCol:k.field,selectedMasterField:h.selectedMasterField,selectedState:(h.selectedMasterTable||"").toLowerCase()}:void 0;return esColToKCol(a,b)});h.columnSets=_.sortBy(_.map(_.filter(c.LayoutColumnSet,function(a){return a.fFilterID.toLowerCase()==f}),function(a){return{aa:parseInt(a.Position),title:a.Caption,columns:void 0}}),"aa"),h.columns=l,h.columnSets&&h.columnSets.length>0?(_.each(h.columnSets,function(a){a.columns=_.filter(l,{columnSet:a.aa}),l=_.difference(l,a.columns)}),h.columnSets=_.sortBy(_.filter(h.columnSets,function(a){return a.columns&&a.columns.length>0}),"aa"),l=h.columnSets.concat(l),h.columns=l):h.columns=l,h.params=new ESParamsDefinitions(h.caption,_.map(c.Param,function(a){return winParamInfoToesParamInfo(a,c)}));var m=_.map(h.params.definitions,function(a){return a.defaultValues});return h.defaultValues=new esGlobals.ESParamValues(m),h}return ESParamInfo.prototype.strVal=function(){return"Hello World esParaminfo"},ESParamInfo.prototype.isInvestigateZoom=function(){return this.invSelectedMasterTable&&this.invSelectedMasterTable.length>4&&"Z"==this.invSelectedMasterTable[4]},ESParamInfo.prototype.isInvestigateEntity=function(){return!this.invSelectedMasterTable||this.isInvestigateZoom()?!1:!0},ESParamsDefinitions.prototype.visibleDefinitions=function(){var a=this.definitions;return a?_.filter(a,{visible:!0}):[]},ESParamsDefinitions.prototype.strVal=function(a){if(!a||!this.definitions||0==this.definitions.length)return"";var b=_.reduce(_.sortBy(_.filter(this.definitions,{visible:!0}),"aa"),function(b,c){return b+"<h3>"+c.caption+": </h3>"+a[c.id].strVal()+"<br/>"},"");return b},{ESRequeryDetailGrids:ESRequeryDetailGrids,ESMasterDetailGridRelation:ESMasterDetailGridRelation,winGridInfoToESGridInfo:winGridInfoToESGridInfo,winColToESCol:winColToESCol,esColToKCol:esColToKCol,esGridInfoToLocalKInfo:esGridInfoToLocalKInfo,esGridInfoToKInfo:esGridInfoToKInfo,getZoomDataSource:prepareStdZoom,getPQDataSource:prepareWebScroller,getPivotDS:preparePivotDS,createEsParamVal:createEsParamVal,createESParams:createESParams,onMapClick:function(a,b,c){alert("A location has been clicked. Soon you will see a form here !!!")}}}])}();