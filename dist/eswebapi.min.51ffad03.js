/*! Entersoft Application Server WEB API - v0.0.1 - 2015-07-27
* Copyright (c) 2015 Entersoft SA; Licensed Apache-2.0 */
!function(){"use strict";function a(a,b){return-1!==a.indexOf(b,a.length-b.length)}function b(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())}var c=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);c.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__PUBLICQUERY_INFO__:"api/rpc/PublicQueryInfo/",__USERSITES__:"api/Login/Usersites",__STANDARD_ZOOM__:"api/rpc/FetchStdZoom/",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__SCROLLER__:"api/rpc/SimpleScroller/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__REGISTER_EXCEPTION__:"api/rpc/registerException/",__FETCH_COMPANY_PARAM__:"api/rpc/FetchCompanyParam/",__FETCH_COMPANY_PARAMS__:"api/rpc/FetchCompanyParams/",__SCROLLER_COMMAND__:"api/rpc/ScrollerCommand/",__FORM_COMMAND__:"api/rpc/FormCommand/",__FETCH_SESSION_INFO__:"api/rpc/FetchSessionInfo/",__FETCH_ODS_TABLE_INFO__:"api/rpc/FetchOdsTableInfo/",__FETCH_ODS_COLUMN_INFO__:"api/rpc/FetchOdsColumnInfo/",__FETCH_ODS_RELATION_INFO__:"api/rpc/FetchOdsRelationInfo/",__FETCH_ODS_DETAIL_RELATIONS_INFO__:"api/rpc/FetchOdsDetailRelationsInfo/",__FETCH_ODS_MASTER_RELATIONS_INFO__:"api/rpc/FetchOdsMasterRelationsInfo/"}),c.value("__WEBAPI_RT__",{url:""}),c.provider("es.Services.WebApi",function(){var c="",d="",e="",f={host:"",allowUnsecureConnection:!1,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return f},getServerUrl:function(){return c},setSettings:function(g){var h="https://",i="http://";if(f=g,!f.host)throw"host for Entersoft WEB API Server is not specified";if(f.host=f.host.trim(),b(f.host,h)?f.host=f.host.slice(h.length).trim():b(f.host,i)&&(f.host=f.host.slice(i.length).trim()),""==f.host)throw"host for Entersoft WEB API Server is not specified";return a(f.host,"/")||(f.host+="/"),d=i+f.host,e=h+f.host,c=f.allowUnsecureConnection?d:e,this},$get:["$http","$log","$q","$rootScope","ESWEBAPI_URL","es.Services.Globals","es.Services.Messaging",function(a,b,g,h,i,j,k){function l(a,d){if(a){var e=angular.copy(a);try{e.__SubscriptionID=f.subscriptionId,e.__ServerUrl=c,e.__EDate=new Date,$.ajax({type:"POST",url:c.concat(i.__REGISTER_EXCEPTION__),contentType:"application/json",headers:{Authorization:j.getWebApiToken()},data:JSON.stringify({exceptionData:e,exceptionStore:d},null,"	")});var g=j.getGA();g&&g.registerException(e)}catch(h){b.warn("Error logging failed"),b.error(h)}}}function m(b){if(!b||!b.ScrollerID||!b.CommandID)throw"ScrollerID and CommandID properties must be defined";var c=i.__SCROLLER_COMMAND__,d=j.trackTimer("SCR","COMMAND",b.ScrollerID.concat("/",b.CommandID));d.startTime();var e=a({method:"post",headers:{Authorization:j.getWebApiToken()},url:c,data:b});return e.then(function(){d.endTime().send()}),e}function n(b,d){var e=c+i[b]+d,f=a({method:"get",headers:{Authorization:j.getWebApiToken()},url:e});return q(f),f}function o(b){if(!b||!b.EntityID||!b.CommandID)throw"EntityID and CommandID properties must be defined";var d=c+i.__FORM_COMMAND__,e=j.trackTimer("FORM","COMMAND",b.EntityID.concat("/",b.CommandID));e.startTime();var f=a({method:"post",headers:{Authorization:j.getWebApiToken()},url:d,data:b});return q(f,e)}function p(b,d,e,f){var g=c.concat(b,d,"/",e),h=j.trackTimer("SCR","FETCH",d.concat("/",e));h.startTime();var i=a({method:"GET",headers:{Authorization:j.getWebApiToken()},url:g,params:f});return q(i,h)}function q(a,b){return b&&a.then(function(){b.endTime().send()}),a.error(function(a,b){k.publish("ES_HTTP_CORE_ERR",a,b)}),a}return{getServerUrl:function(){return c},openSession:function(d){var e=j.trackTimer("AUTH","LOGIN","");e.startTime();var g=a({method:"post",url:c+i.__LOGIN__,data:{SubscriptionID:f.subscriptionId,SubscriptionPassword:f.subscriptionPassword,Model:d}}).success(function(a){j.sessionOpened(a,d),e.endTime().send()}).error(function(a,c,d,e){j.sessionClosed(),a?b.error(a):console.log("Generic Http error")});return q(g)},logout:function(){j.sessionClosed(),b.info("LOGOUT User")},fetchCompanyParam:function(b){if(!b)return void 0;var d=c.concat(i.__FETCH_COMPANY_PARAM__,b),e=a({method:"get",headers:{Authorization:j.getWebApiToken()},url:d});return q(e)},fetchCompanyParams:function(b){var d;d=b?angular.isArray(b)?c+i.__FETCH_COMPANY_PARAMS__+b.join("/"):c+i.__FETCH_COMPANY_PARAMS__+b:c+i.__FETCH_COMPANY_PARAMS__;var e=a({method:"get",headers:{Authorization:j.getWebApiToken()},url:d});return q(e)},registerException:l,fetchOdsTableInfo:function(a){return n("__FETCH_ODS_TABLE_INFO__",a)},fetchOdsColumnInfo:function(a,b){var c=b?a+"/"+b:a;return n("__FETCH_ODS_COLUMN_INFO__",c)},fetchOdsRelationInfo:function(a){return n("__FETCH_ODS_RELATION_INFO__",a)},fetchOdsMasterRelationsInfo:function(a,b){return n("__FETCH_ODS_MASTER_RELATIONS_INFO__",a+"/"+b)},fetchOdsdDetailRelationsInfo:function(a,b){return n("__FETCH_ODS_DETAIL_RELATIONS_INFO__",a+"/"+b)},fetchServerCapabilities:function(){var b=g.defer();return a.get(d+i.__SERVER_CAPABILITIES__).success(function(a){b.resolve(a)}).error(function(){a.get(e+i.__SERVER_CAPABILITIES__).success(function(a){b.resolve(a)}).error(function(a,c,d,e){b.reject([a,c,d,e])})}),b.promise},fetchScroller:function(a,b,c){return p(i.__SCROLLER__,a,b,c)},fetchSimpleScrollerRootTable:function(a,b,c){return p(i.__SCROLLERROOTTABLE__,a,b,c)},fetchUserSites:function(b){var d=a({method:"post",url:c+i.__USERSITES__,data:{SubscriptionID:f.subscriptionId,SubscriptionPassword:f.subscriptionPassword,Model:b}});return q(d)},fetchSessionInfo:function(){var b=a({method:"get",headers:{Authorization:j.getWebApiToken()},url:c+i.__FETCH_SESSION_INFO__});return q(b)},executeNewEntityAction:function(b,d,e){var f=c.concat(i.__ENTITYACTION__,b,"/",d),g=j.trackTimer("ACTION","NEW_ENTITY",b.concat("/",d));g.startTime();var h=a({method:"post",headers:{Authorization:j.getWebApiToken()},url:f,data:e});return q(h,g)},executeEntityActionByCode:function(b,d,e,f){var g=c.concat(i.__ENTITYACTION__,b,"/",d,"/",e),h=j.trackTimer("ACTION","ENTITY_CODE",b.concat("/",e));h.startTime();var k=a({method:"post",headers:{Authorization:j.getWebApiToken()},url:g,data:f});return q(k,h)},executeEntityActionByGID:function(b,d,e,f){var g=c.concat(i.__ENTITYBYGIDACTION__,b,"/",d,"/",e),h=j.trackTimer("ACTION","ENTITY_GID",b.concat("/",e));h.startTime();var k=a({method:"post",headers:{Authorization:j.getWebApiToken()},url:g,data:f});return q(k,h)},executeFormCommand:function(a){return o(a)},executeFormCommandDS:function(a,b,c,d){var e={EntityID:a,CommandID:b,CommandParams:c};return d&&(e.EntityDataset=d),o(e)},executeScrollerCommandSRV:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerParams:d,CommandParams:e};return m(f)},executeScrollerCommandDS:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerDataset:d,CommandParams:e};return m(f)},fetchPublicQueryInfo:function(b,d){var e=c.concat(i.__PUBLICQUERY_INFO__,b,"/",d),f=j.trackTimer("PQ","INFO",b.concat("/",d));f.startTime();var g=a({method:"get",headers:{Authorization:j.getWebApiToken()},url:e});return q(g,f)},fetchStdZoom:function(b,d){var e=c.concat(i.__STANDARD_ZOOM__,b),f=j.trackTimer("ZOOM","FETCH",b);f.startTime();var g=a({method:"get",headers:{Authorization:j.getWebApiToken(),"X-ESPQOptions":JSON.stringify(d)},url:e});return q(g,f)},fetchPublicQuery:function(b,d,e,f,g){var h=c.concat(i.__PUBLICQUERY__,b,"/",d),k=j.trackTimer("PQ","FETCH",b.concat("/",d));k.startTime();var l={headers:{Authorization:j.getWebApiToken()},url:h,params:f};e&&(l.headers["X-ESPQOptions"]=JSON.stringify(e)),l.method=g||"GET","GET"!==l.method&&(delete l.params,l.data=f);var m=a(l);return q(m,k)},eSearch:function(b,d,e){var f=c.concat(i.__ELASTICSEARCH__,b),g=a({method:d,headers:{Authorization:j.getWebApiToken()},url:f,data:e}).success(function(a){var c=j.getGA();c&&c.registerEventTrack({category:"ELASTIC_SEARCH",action:"SEARCH",label:b})}).error(function(a){try{l(a)}catch(b){}});return q(g)}}}]}}),c.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(a){return{searchIndex:function(b,c){var d=b+"/_search";return a.eSearch(d,"post",c)},searchIndexAndDocument:function(b,c,d){var e=b+"/"+c+"/_search";return a.eSearch(e,"post",d)},searchFree:a.eSearch}}])}(),function(){"use strict";var a=angular.module("es.Services.Analytics",[]);a.provider("es.Services.GA",function(){var a={gaKey:void 0,pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},developerMode:!1};return{setGAKey:function(a){gaKey=a},settings:a,virtualPageviews:function(a){this.settings.pageTracking.autoTrackVirtualPages=a},firstPageview:function(a){this.settings.pageTracking.autoTrackFirstPage=a},withBase:function(a){this.settings.pageTracking.basePath=a?angular.element("base").attr("href").slice(0,-1):""},withAutoBase:function(a){this.settings.pageTracking.autoBasePath=a},developerMode:function(a){this.settings.developerMode=a},start:function(b,c){window.ga&&b&&""!=b&&(a.gaKey=b,ga("create",b,c))},$get:["$window",function(b){return{settings:a,registerPageTrack:function(a){b.ga&&b.ga("send","pageview",a)},registerException:function(a){b.ga&&a&&b.ga("send","exception",{exDescription:JSON.stringify(a),exFatal:!1})},registerTiming:function(a){if(b.ga){if(!(a&&a.timingCategory&&a.timingVar&&a.timingValue))return;if(a.timingValue){var c=parseInt(a.timingValue,10);if(a.timingValue=isNaN(c)?0:c,0==a.timingValue)return}b.ga("send","timing",a)}},registerEventTrack:function(a){if(b.ga){if(!a||!a.category)return;if(a.value){var c=parseInt(a.value,10);a.value=isNaN(c)?0:c}for(var d={eventCategory:a.category||null,eventAction:a.action||null,eventLabel:a.label||null,eventValue:a.value||null,nonInteraction:a.noninteraction||null},e=1;20>=e;e++)a["dimension"+e.toString()]&&(d["dimension"+e.toString()]=a["dimension"+e.toString()]),a["metric"+e.toString()]&&(d["metric"+e.toString()]=a["metric"+e.toString()]);b.ga("send","event",d)}}}}]}}),a.run(["$rootScope","$window","es.Services.GA","$injector",function(a,b,c,d){c.settings.pageTracking.autoTrackFirstPage&&d.invoke(["$location",function(a){var e=!0;if(d.has("$route")){var f=d.get("$route");for(var g in f.routes){e=!1;break}}else if(d.has("$state")){var h=d.get("$state");for(var i in h.get()){e=!1;break}}if(e)if(c.settings.pageTracking.autoBasePath&&(c.settings.pageTracking.basePath=b.location.pathname),c.settings.trackRelativePath){var j=c.settings.pageTracking.basePath+a.url();c.registerPageTrack(j,a)}else c.registerPageTrack(a.absUrl(),a)}]),c.settings.pageTracking.autoTrackVirtualPages&&d.invoke(["$location",function(e){c.settings.pageTracking.autoBasePath&&(c.settings.pageTracking.basePath=b.location.pathname+"#"),d.has("$route")&&a.$on("$routeChangeSuccess",function(a,b){if(!b||!(b.$$route||b).redirectTo){var d=c.settings.pageTracking.basePath+e.url();c.registerPageTrack(d,e)}}),d.has("$state")&&a.$on("$stateChangeSuccess",function(a,b){var d=c.settings.pageTracking.basePath+e.url();c.registerPageTrack(d,e)})}]),c.settings.developerMode&&angular.forEach(c,function(a,b){"function"==typeof a&&(c[b]=function(){})})}]),a.directive("esAnalyticsOn",["$document","es.Services.GA",function(a,b){function c(a){return a.tagName.toLowerCase()+":"+(a.type||"")=="a:"}function d(a){return["button:","button:button","button:submit","input:button","input:submit"].indexOf(a.tagName.toLowerCase()+":"+(a.type||""))>=0}function e(a){return d(a)||c(a),"click"}function f(b){if(d(b))return"Command";if(c(b)){if(!b.href)return"Navigate";var e=b.href,f=/\.(mov|jpg|png|rar|avi|zip|exe|pdf|doc*|xls*|ppt*|mp*)$/i;if(e.match(/^https?\:/i)){var g=e.match(f);return e.match(a[0].domain)?g?"Internal Download":"Internal Link":g?"External Download":"External Link"}return e.match(/^mailto\:/i)?"Mail To":e.match(f)?"Download":"Navigate"}return b.id||b.name||b.tagName}function g(a){return d(a)?a.tagName.toLowerCase()+":"+(a.type||""):c(a)?a.href?a.href:a.innerText||a.value:a.id||a.name||a.tagName}function h(a){return d(a)||c(a)?a.innerText||a.value:a.id||a.name||a.tagName}function i(a){return"esAnalytics"===a.substr(0,11)&&-1===["On","If","Properties","EventType"].indexOf(a.substr(11))}function j(a){var b=a.slice(11);return"undefined"!=typeof b&&null!==b&&b.length>0?b.substring(0,1).toLowerCase()+b.substring(1):b}return{restrict:"A",link:function(c,d,k){var l=k.esAnalyticsOn||e(d[0]),m={};angular.forEach(k.$attr,function(a,b){i(b)&&(m[j(b)]=k[b],k.$observe(b,function(a){m[j(b)]=a}))}),m.category=m.category||f(d[0],a),m.action=m.action||g(d[0],a),m.label=m.label||h(d[0],a),angular.element(d[0]).bind(l,function(a){(!k.esAnalyticsIf||c.$eval(k.esAnalyticsIf))&&(k.esAnalyticsProperties&&angular.extend(m,c.$eval(k.esAnalyticsProperties)),b.registerEventTrack(m))})}}}])}(),function(a){"use strict";a.module("es.services.Web.Environment",[]).provider("Environment",[function(){function a(){var a=document.location.href.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return a&&a[1]}var b={dev:[],prod:[],staging:[]},c="dev",d="/KB/app/images",e="/KB/app/templates";return{setStage:function(a){c=a},getStage:function(){return c},setAssetsPath:function(a){d=a},setTemplatesPath:function(a){e=a},addDevelopmentDomains:function(a){return b.dev=a,this},addProductionDomains:function(a){return b.prod=a,this},addStagingDomains:function(a){return b.staging=a,this},setStageFromDomain:function(){var d;for(var e in b)if(d=a(),b[e].indexOf(d)>=0){c=e;break}},$get:function(){return{stage:c,assetsPath:d,templatesPath:e,isDev:function(){return"dev"===c},isProduction:function(){return"prod"===c},isStaging:function(){return"staging"===c},getAssetsPath:function(){return d},getTemplatesPath:function(){return e}}}}}])}(window.angular),function(a,b,c){"use strict";var d,e={},f={sdk:!1,ready:!1};b.module("es.Services.Social",[]).value("settings",e).value("flags",f).provider("esFacebook",[function(){e.appId=null,this.setAppId=function(a){e.appId=a},this.getAppId=function(){return e.appId},e.locale="en_US",this.setLocale=function(a){e.locale=a},this.getLocale=function(){return e.locale},e.status=!0,this.setStatus=function(a){e.status=a},this.getStatus=function(){return e.status},e.channelUrl=null,this.setChannel=function(a){e.channelUrl=a},this.getChannel=function(){return e.channelUrl},e.cookie=!0,this.setCookie=function(a){e.cookie=a},this.getCookie=function(){return e.cookie},e.xfbml=!0,this.setXfbml=function(a){e.xfbml=a},this.getXfbml=function(){return e.xfbml},this.setAuthResponse=function(a){e.authResponse=a||!0},this.getAuthResponse=function(){return e.authResponse},e.frictionlessRequests=!1,this.setFrictionlessRequests=function(a){e.frictionlessRequests=a},this.getFrictionlessRequests=function(){return e.frictionlessRequests},e.hideFlashCallback=null,this.setHideFlashCallback=function(a){e.hideFlashCallback=a||null},this.getHideFlashCallback=function(){return e.hideFlashCallback},this.setInitCustomOption=function(a,c){return b.isString(a)?(e[a]=c,e[a]):!1},this.getInitOption=function(a){return b.isString(a)&&e.hasOwnProperty(a)?e[a]:!1},e.loadSDK=!0,this.setLoadSDK=function(a){e.loadSDK=!!a},this.getLoadSDK=function(){return e.loadSDK},e.version="v2.2",this.setSdkVersion=function(a){e.version=a},this.getSdkVersion=function(){return e.version},this.init=function(a,c){b.isString(a)&&(e.appId=a),b.isNumber(a)&&(e.appId=a.toString()),b.isObject(a)&&b.extend(e,a),b.isDefined(c)&&(e.loadSDK=!!c)},this.$get=["$q","$rootScope","$timeout","$window",function(a,c,g,h){function i(){this.appId=e.appId}return i.prototype.isReady=function(){return f.ready},i.prototype.login=function(){var c,d,e=a.defer(),f=Array.prototype.slice.call(arguments);return b.forEach(f,function(a,e){b.isFunction(a)&&(c=a,d=e)}),b.isFunction(c)&&b.isNumber(d)&&f.splice(d,1,function(a){g(function(){a&&b.isUndefined(a.error)?e.resolve(a):e.reject(a),b.isFunction(c)&&c(a)})}),this.isReady()?h.FB.login.apply(h.FB,f):g(function(){e.reject("Facebook.login() called before Facebook SDK has loaded.")}),e.promise},b.forEach(["logout","api","ui","getLoginStatus"],function(c){i.prototype[c]=function(){var e,f,i=a.defer(),j=Array.prototype.slice.call(arguments);return b.forEach(j,function(a,c){b.isFunction(a)&&(e=a,f=c)}),b.isFunction(e)&&b.isNumber(f)&&j.splice(f,1,function(a){g(function(){a&&b.isUndefined(a.error)?i.resolve(a):i.reject(a),b.isFunction(e)&&e(a)})}),g(function(){d.promise.then(function(){h.FB[c].apply(FB,j)})}),i.promise}}),i.prototype.parseXFBML=function(){var b=a.defer();return g(function(){d.promise.then(function(){h.FB.XFBML.parse(),b.resolve()})}),b.promise},b.forEach(["subscribe","unsubscribe"],function(c){i.prototype[c]=function(){var e,f,i=a.defer(),j=Array.prototype.slice.call(arguments);return b.forEach(j,function(a,c){b.isFunction(a)&&(e=a,f=c)}),b.isFunction(e)&&b.isNumber(f)&&j.splice(f,1,function(a){g(function(){a&&b.isUndefined(a.error)?i.resolve(a):i.reject(a),b.isFunction(e)&&e(a)})}),g(function(){d.promise.then(function(){h.FB.Event[c].apply(FB,j)})}),i.promise}}),new i}]}]).run(["$rootScope","$q","$window","$timeout",function(a,c,g,h){d=c.defer();var i=e.loadSDK;delete e.loadSDK,g.fbAsyncInit=function(){h(function(){if(!e.appId)throw"Missing appId setting.";FB.init(e),f.ready=!0,b.forEach({"auth.login":"login","auth.logout":"logout","auth.prompt":"prompt","auth.sessionChange":"sessionChange","auth.statusChange":"statusChange","auth.authResponseChange":"authResponseChange","xfbml.render":"xfbmlRender","edge.create":"like","edge.remove":"unlike","comment.create":"comment","comment.remove":"uncomment"},function(b,c){FB.Event.subscribe(c,function(c){h(function(){a.$broadcast("Facebook:"+b,c)})})}),a.$broadcast("Facebook:load"),d.resolve(FB)})},function(){var a=document.getElementById("fb-root");return a||(a=document.createElement("div"),a.id="fb-root",document.body.insertBefore(a,document.body.childNodes[0])),a}(),i&&!function(){var a="//connect.facebook.net/"+e.locale+"/sdk.js",b=document.createElement("script");b.id="facebook-jssdk",b.async=!0,-1!==g.location.protocol.indexOf("file:")&&(a="https:"+a),b.src=a,b.onload=function(){f.sdk=!0},document.getElementsByTagName("head")[0].appendChild(b)}()}])}(window,angular),function(){"use strict";var a=angular.module("underscore",[]);a.factory("_",function(){return window._});var b=angular.module("es.Services.Web");b.provider("es.Services.Cache",function(){var a=null,b={};return b.maxSize=-1,b.storage=null,{setMaxSize:function(a){angular.isNumber(a)&&(b.maxSize=a)},getMaxSize:function(){return b.maxSize},getStorageSettings:function(){return b.storage},setStorageSettings:function(a){b&&(b.storage=b)},$get:function(){if("undefined"==typeof Cache)throw"You must include jscache.js";return a=new Cache(b.maxSize,!1,b.storage),{getItem:function(b){return a.getItem(b)},setItem:function(b,c,d){a.setItem(b,c,d)},removeItem:function(b){a.removeItem(b)},removeWhere:function(b){a.removeWhere(function(a,c){return b(a,c)})},size:function(){return a.size()},clear:function(){a.clear()},stats:function(){return a.stats()}}}}}),b.factory("es.Services.Messaging",function(){function a(){if(!arguments||arguments.Length<1)throw"Publishing events requires at least one argument for topic id";var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d[a]&&angular.forEach(d[a],function(c){try{c.apply(null,b)}catch(d){console.log("Error in messaging handler for topic ",a)}})}function b(a,b){return d[a]||(d[a]=[]),d[a].push(b),[a,b]}function c(a){var b=a[0];d[b]&&angular.forEach(d[b],function(c){this==a[1]&&d[b].splice(c,1)})}var d={},e={publish:a,subscribe:b,unsubscribe:c};return e}),b.factory("es.Services.Globals",["$sessionStorage","$log","es.Services.Messaging","$injector",function(a,b,c,d){function e(){if(!d)return void 0;try{return d.get("es.Services.GA")}catch(a){return void 0}}function f(){if(!k.connectionModel){var d=a,f=null;if("undefined"!=typeof d.__esrequest_sesssion&&null!==d.__esrequest_sesssion){f=d.__esrequest_sesssion,k.connectionModel=f,c.publish("AUTH_CHANGED",k,i(f));var g=e();angular.isDefined(g)&&g.registerEventTrack({category:"AUTH",action:"RELOGIN",label:k.connectionModel.GID}),b.info("RELOGIN User ",k.connectionModel.Name)}else c.publish("AUTH_CHANGED",null,i(null)),b.info("NO RELOGIN from stored state")}return k.connectionModel}function g(b){var d=null;if(k.connectionModel&&(d=k.connectionModel.GID),k.connectionModel=b,b)a.__esrequest_sesssion=b;else{delete a.__esrequest_sesssion;var f=e();angular.isDefined(f)&&f.registerEventTrack({category:"AUTH",action:"LOGOUT",label:d})}c.publish("AUTH_CHANGED",k,i(b))}function h(a,b){if(!a)switch(b){case 401:return"Please Login first";case 403:return"You are not authorized. Please Login and try again";case 500:default:return"General Error. Please check your network and internet access"}var c="";if(a.UserMessage)return c=a.UserMessage,a.MessageID&&(c=c+" ("+a.MessageID+")"),c;if(a.Messages){if(angular.isArray(a.Messages)){var d=0;c=_.reduce(a.Messages,function(a,b){return a+"\r\n["+d+"]"+b},"")}else c=a.Messages;return c?c:"General Error. Please check your network and internet access"}return"General Error. Please check your network and internet access"}function i(a){return a?"Bearer "+a.WebApiToken:""}function j(a,b,c){return this.category=a,this.variable=b,this.label=c?c:void 0,this.startTime,this.endTime,this}var k={hostUrl:"",credentials:null,connectionModel:null,getWebApiToken:function(){return i(f())},setModel:g,getModel:f};return j.prototype.startTime=function(){return this.startTime=(new Date).getTime(),this},j.prototype.endTime=function(){return this.endTime=(new Date).getTime(),this},j.prototype.send=function(){var a=this.endTime-this.startTime,b=e();return b?(b.registerTiming({timingCategory:this.category,timingVar:this.variable,timingValue:a,timingLabel:this.label}),this):void 0},{getVersion:function(){return{Major:0,Minor:0,Patch:140}},getGA:e,getWebApiToken:function(){return k.getWebApiToken()},getClientSession:function(){return k},getUserMessage:h,sessionClosed:function(){k.setModel(null)},trackTimer:function(a,b,c){return new j(a,b,c)},sessionOpened:function(a,c){try{k.setModel(a.Model),k.credentials=c;var d=e();if(angular.isDefined(d)){var f;for(f=0;12>f;f++)angular.isDefined(d)&&d.registerEventTrack({category:"AUTH",action:"LOGIN",label:a.Model.GID})}b.info("LOGIN User ",a.Model.Name)}catch(g){throw b.error(g),g}}}}]),b.run(["es.Services.Globals","es.Services.WebApi",function(a,b){var c=a.getClientSession();c.getModel(),c.hostUrl=b.getServerUrl()}])}(),function(){"use strict";var a=angular.module("es.Services.Web");a.factory("es.Services.StackTrace",function(){return{print:printStackTrace}}),a.provider("$log",function(){function a(){return log4javascript.getLogger("esLogger")}function b(a){d(new log4javascript.BrowserConsoleAppender);var b=angular.isDefined(a)&&a;b&&d(new log4javascript.PopUpAppender)}function c(a,b){if(f){i&&a&&a.connectionModel&&(i.setCustomField("userId",a.connectionModel.UserID),a.credentials&&(i.setCustomField("branchId",a.credentials.BranchID),i.setCustomField("langId",a.credentials.LangID)));var c=f.getHeaders();if(c){var d,e=-1;for(d=0;d<c.length;d++)if("Authorization"==c[d].name){e=d;break}-1!=e&&c.splice(e,1)}b&&""!=b&&f.addHeader("Authorization",b)}}function d(a){return-1==e.indexOf(a)?(e.push(a),!0):!1}var e=[],f=null,g=null,h=log4javascript.Level.ALL,i=null;return{setLevel:function(a){h=a,g&&g.setLevel(h)},getLevel:function(){return h},getCurrentLevel:function(){return g?g.getEffectiveLevel():log4javascript.Level.OFF},addAppender:d,addDefaultAppenders:b,addESWebApiAppender:function(a,b){var c=a+"api/rpc/registerException/";return f=new log4javascript.AjaxAppender(c,!1),f.setSendAllOnUnload(!0),i=new log4javascript.JsonLayout,i.setCustomField("subscriptionId",b),f.setLayout(i),f.setWaitForResponse(!0),f.setBatchSize(100),f.setTimed(!0),f.setTimerInterval(6e4),f.addHeader("Content-Type","application/json"),f.setRequestSuccessCallback(function(a){console.log("ES Logger, BATCH of logs upoloaded",a.responseURL,a.status)}),f.setFailCallback(function(a){console.error("Failed to POST Logs to the server",a)}),d(f)},$get:["es.Services.Messaging",function(d){try{g=a(),g.setLevel(h),0==e.length&&b();var i=0;for(i=0;i<e.length;i++)g.addAppender(e[i]);return d.subscribe("AUTH_CHANGED",function(a,b){c(a,b)}),g.sendAll=function(){try{f&&f.sendAll()}catch(a){}},console.info("ES Logger started"),g}catch(j){return console.log("Error in starting entersoft logger",j),$log}}]}}),a.provider("$exceptionHandler",function(){var a={pushToServer:!1,logServer:""};return{getSettings:function(){return a},setPushToServer:function(b){a.pushToServer=b},setLogServer:function(b){a.logServer=b},$get:["$log","$window","es.Services.StackTrace","$injector",function(b,c,d,e){function f(f,g){var h,i,j;try{h=f.toString(),i=d.print({e:f}),j={errorUrl:c.location.href,errorMessage:h,stackTrace:i,cause:g||""},b.error(JSON.stringify(j,null,"	"))}catch(k){console.log(arguments)}if(a.pushToServer)try{var l=e.get("es.Services.WebApi");l.registerException(j,a.logServer)}catch(k){b.warn("ES Error in registerException on store "+a.logServer),b.error(k)}}return f}]}})}(),function(){"use strict";function ESParamVal(a,b){this.paramCode=a,this.paramValue=b}function ESNumericParamVal(a,b){ESParamVal.call(this,a,b)}function ESStringParamVal(a,b){ESParamVal.call(this,a,b)}function ESParamValues(a){this.setParamValues(a)}function prepareStdZoom(a,b,c){var d={transport:{read:function(d){a.info("FETCHing ZOOM data for [",b,"] with options ",JSON.stringify(d));var e={};c.fetchStdZoom(b,e).success(function(c){-1==c.Count&&(c.Count=c.Rows?c.Rows.length:0),d.success(c),a.info("FETCHed ZOOM data for [",b,"] with options ",JSON.stringify(d))}).error(function(a){d.error(a)})}},schema:{data:"Rows",total:"Count"}};return new kendo.data.DataSource(d)}function prepareWebScroller(a,b,c,d,e){var f={transport:{read:function(a){var e=angular.isFunction(d)?d():d;c.info("FETCHing PQ with PQParams ",JSON.stringify(e)," and gridoptions ",JSON.stringify(a));var f={};a.data&&a.data.page&&a.data.pageSize&&(f.WithCount=!0,f.Page=a.data.page,f.PageSize=a.data.pageSize);var g=e.Params;g instanceof ESParamValues&&(g=g.getExecuteVals()),b.fetchPublicQuery(e.GroupID,e.FilterID,f,g).success(function(b){angular.isDefined(b.Rows)||(b.Rows=[],b.Count=0),angular.isDefined(b.Count)||(b.Count=-1),a.success(b),c.info("FETCHed PQ with PQParams ",JSON.stringify(g)," and gridoptions ",JSON.stringify(a))}).error(function(b){c.error("Error in DataSource ",b),a.error(b)})}},requestStart:function(a){c.info("request started ",a)},schema:{data:"Rows",total:"Count"}};return e&&angular.extend(f,e),a&&"pivot"===a?new kendo.data.PivotDataSource(f):new kendo.data.DataSource(f)}var esWEBUI=angular.module("es.Web.UI",[]),esComplexParamFunctionOptions=[{caption:"=",value:"EQ"},{caption:"<>",value:"NE"},{caption:"<",value:"LT"},{caption:"<=",value:"LE"},{caption:">",value:"GT"},{caption:">=",value:"GE"},{caption:"...<=...<=...",value:"RANGE"},{caption:"Empty",value:"NULL"},{caption:"Not Empty",value:"NOTNULL"}];ESParamVal.prototype.getExecuteVal=function(){return this.paramValue},ESNumericParamVal.prototype=Object.create(ESParamVal.prototype),ESNumericParamVal.prototype.getExecuteVal=function(){switch(this.paramValue.oper){case"RANGE":return"ESNumeric("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESNumeric("+this.paramValue.oper+", '0')";default:return"ESNumeric("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},ESStringParamVal.prototype=Object.create(ESParamVal.prototype),ESStringParamVal.prototype.getExecuteVal=function(){switch(this.paramValue.oper){case"EQ":return this.paramValue.value;case"RANGE":return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESString("+this.paramValue.oper+", '')";default:return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},ESParamValues.prototype.setParamValues=function(a){var b=this;for(var c in b)b.hasOwnProperty(c)&&delete b[c];a&&_.isArray(a)&&0!=a.length&&a.forEach(function(a,c,d){b[a.paramCode]=a})},ESParamValues.prototype.getExecuteVals=function(){var a=this,b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];(d.paramValue||angular.isNumber(d.paramValue)&&0==d.paramValue)&&(b[d.paramCode]=d.getExecuteVal())}return b},esWEBUI.filter("esTrustHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),esWEBUI.filter("esParamTypeMapper",function(){var a=function(a){if(!a)return"";var b=a.parameterType.toLowerCase();if(0==b.indexOf("entersoft.framework.platform.esnumeric"))return"esParamAdvancedNumeric";if(0==b.indexOf("entersoft.framework.platform.esstring, queryprocess"))return"esParamAdvancedString";if(0==b.indexOf("system.string, mscorlib"))switch(a.controlType){case 1:return"esParamNumeric";case 2:return"esParamNumeric"}return a.enumList&&a.enumList.length>1?a.enumOptionAll?"esParamMultiEnum":"esParamEnum":a.invSelectedMasterTable&&"Z"==a.invSelectedMasterTable[4]?a.multiValued?"esParamMultiZoom":"esParamZoom":"esParamText"};return a}).directive("esGrid",["es.Services.WebApi","es.UI.Web.UIHelper","$log",function(a,b,c){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esExecuteParams:"=",esGridOptions:"="},templateUrl:function(a,b){return c.info("Parameter element = ",a," Parameter attrs = ",b),"src/partials/esGrid.html"},link:function(c,d,e){if(!c.esGroupId||!c.esFilterId)throw"You must set GroupID and FilterID for esgrid to work";c.esGridOptions||e.esGridOptions||a.fetchPublicQueryInfo(c.esGroupId,c.esFilterId).success(function(d){var e=d,f=b.winGridInfoToESGridInfo(c.esGroupId,c.esFilterId,e);c.esGridOptions=b.esGridInfoToKInfo(a,c.esGroupId,c.esFilterId,c.esExecuteParams,f)})}}}]).directive("esParam",["$log","es.Services.WebApi","es.UI.Web.UIHelper",function(a,b,c){return{restrict:"AE",scope:{esParamDef:"=",esParamVal:"=",esType:"="},template:"<div ng-include src=\"'src/partials/'+esType+'.html'\"></div>",link:function(d,e,f){if(!d.esParamDef)throw"You must set a param";d.esWebUIHelper=c,d.esWebApiService=b,d.esParamDef.invSelectedMasterTable&&(d.esParamLookupDS=prepareStdZoom(a,d.esParamDef.invSelectedMasterTable,b))}}}]).directive("esWebPq",["$log","es.Services.WebApi","es.UI.Web.UIHelper",function(a,b,c){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esGridOptions:"=",esParamsValues:"="},templateUrl:function(b,c){return a.info("Parameter element = ",b," Parameter attrs = ",c),"src/partials/esWebPQ.html"},link:function(a,d,e){if(!a.esGroupId||!a.esFilterId)throw"You must set the pair es-group-id and es-filter-id attrs";b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId).success(function(d){var e=c.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,d);a.esParamsValues=e.defaultValues,a.esParamsDef=e.params,a.esGridOptions=c.esGridInfoToKInfo(b,a.esGroupId,a.esFilterId,a.esParamsValues,e)})}}}]).directive("esParamsPanel",["$log","es.Services.WebApi","es.UI.Web.UIHelper",function(a,b,c){return{restrict:"AE",scope:{esParamsDef:"=",esPqInfo:"=",esParamsValues:"=",esGroupId:"=",esFilterId:"="},templateUrl:function(b,c){return a.info("Parameter element = ",b," Parameter attrs = ",c),"src/partials/esParams.html"},link:function(a,d,e){if(!(e.esParamsDef||e.esPqInfo||a.esGroupId&&a.esFilterId))throw"You must set either the es-params-def or ea-pq-info or the pair es-group-id and es-filter-id attrs";e.esParamsDef||(e.esPqInfo?a.esParamDef=esPqInfo.params:b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId).success(function(b){var d=c.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,b);a.esParamsValues=d.defaultValues,a.esParamsDef=d.params}))}}}]),esWEBUI.factory("es.UI.Web.UIHelper",["es.Services.WebApi","$log",function(esWebApiService,$log){function esColToKCol(a,b){var c={field:b.field,title:b.title,width:b.width,attributes:b.attributes,values:b.enumValues};return b.formatString&&""!=b.formatString&&(c.format="{0:"+b.formatString+"}"),
c}function esGridInfoToKInfo(a,b,c,d,e){var f={pageable:{refresh:!0},sortable:!0,filterable:!0,resizable:!0,toolbar:["excel"],excel:{allPages:!0,fileName:b+"-"+c+".xlsx",filterable:!0}},g={serverFiltering:!0,serverPaging:!0,pageSize:20};return f.columns=e.columns,f.dataSource=prepareWebScroller(null,a,$log,function(){return{GroupID:b,FilterID:c,Params:d}},g),f}function winColToESCol(a,b,c,d){var e={AA:void 0,field:void 0,title:void 0,width:void 0,visible:void 0,attributes:void 0,enumValues:void 0,formatString:void 0};if(e.AA=parseInt(d.AA),e.field=d.ColName,e.title=d.Caption,e.formatString=d.FormatString,e.visible="true"==d.Visible,"3"==d.TextAlignment&&(e.attributes={style:"text-align: right;"}),"5"==d.EditType){var f=_.sortBy(_.filter(c.ValueList,function(a){var c=a.ColName==d.ColName;return c=c&&"undefined"!=typeof a.Value,c=c&&a.fFilterID==b}),function(a){return isNaN(a.Value)?null:parseInt(a.Value)}),g=_.map(f,function(a){return{text:a.Caption,value:isNaN(a.Value)?null:parseInt(a.Value)}});g&&g.length&&(e.enumValues=g)}return e}function esEval(pInfo,expr){var EQ={oper:"EQ",paramID:pInfo.id},GE={oper:"GE",paramID:pInfo.id},GT={oper:"GT",paramID:pInfo.id},LE={oper:"LE",paramID:pInfo.id},LT={oper:"LT",paramID:pInfo.id},NE={oper:"NE",paramID:pInfo.id},RANGE={oper:"RANGE",paramID:pInfo.id},NULL={oper:"NULL",paramID:pInfo.id},NOTNULL={oper:"NOTNULL",paramID:pInfo.id};return eval(expr)}function ESNumeric(a,b,c){var d={value:isNaN(b)?null:parseInt(b),valueTo:isNaN(c)?null:parseInt(c),oper:a.oper||"EQ"};return new ESNumericParamVal(a.paramID,d)}function ESString(a,b,c){var d={value:b,valueTo:c,oper:a.oper||"EQ"};return new ESStringParamVal(a.paramID,d)}function getEsParamVal(a,b){var c=a.parameterType.toLowerCase();if(0==c.indexOf("entersoft.framework.platform.esnumeric"))return b&&0!=b.length?esEval(a,b[0].Value):ESNumeric(a.id,{oper:"EQ"});if(0==c.indexOf("entersoft.framework.platform.esstring, queryprocess"))return b&&0!=b.length?esEval(a,b[0].Value):new ESStringParamVal(a.id,{oper:"EQ",value:null});if(!b||0==b.length)return new ESParamVal(a.id,null);var d=_.map(b,function(b){return processStrToken(a,b.Value)});return 1==d.length&&(d=d[0]),new ESParamVal(a.id,d)}function processStrToken(a,b){if(!a)return b;var c=a.parameterType.toLowerCase();return-1!=c.indexOf("system.byte")||-1!=c.indexOf("system.int")?parseInt(b):a.enumList&&a.enumList.length>1?parseInt(b):b}function winParamInfoToesParamInfo(a,b){if(!a)return null;var c={id:void 0,aa:void 0,caption:void 0,toolTip:void 0,controlType:void 0,parameterType:void 0,precision:void 0,multiValued:void 0,visible:void 0,required:void 0,oDSTag:void 0,formatStrng:void 0,tags:void 0,visibility:void 0,invSelectedMasterTable:void 0,invSelectedMasterField:void 0,invTableMappings:void 0,defaultValues:void 0,enumOptionAll:void 0,enumList:void 0};c.id=a.ID,c.aa=parseInt(a.AA),c.caption=a.Caption,c.toolTip=a.Tooltip,c.controlType=parseInt(a.ControlType),c.parameterType=a.ParameterType,c.precision=parseInt(a.Precision),c.multiValued="true"==a.MultiValued,c.visible="true"==a.Visible,c.required="true"==a.Required,c.oDSTag=a.ODSTag,c.tags=a.Tags,c.visibility=parseInt(a.Visibility),c.invSelectedMasterTable=a.InvSelectedMasterTable,c.invSelectedMasterField=a.InvSelectedMasterField,c.invTableMappings=a.InvTableMappings,c.enumOptionAll=a.EnumOptionAll;var d=_.sortBy(_.map(_.filter(b.EnumItem,function(a){return a.fParamID==c.id&&"undefined"!=typeof a.ID}),function(a){return{text:c.oDSTag?a.Caption.substring(a.Caption.indexOf(".")+1):a.Caption,value:isNaN(a.ID)?null:parseInt(a.ID)}}),"value");c.enumList=d.length?d:void 0;var e=b.DefaultValue;if(e&&angular.isArray(e)){var f=_.where(e,{fParamID:c.id});c.defaultValues=getEsParamVal(c,f)}return c}function winGridInfoToESGridInfo(a,b,c){if(!c||!c.LayoutColumn)return null;var d=b.toLowerCase(),e=_.filter(c.Filter,function(a){return a.ID.toLowerCase()==d});if(!e||1!=e.length)return null;var f={id:void 0,caption:void 0,rootTable:void 0,selectedMasterTable:void 0,selectedMasterField:void 0,totalRow:void 0,columnHeaders:void 0,columnSetHeaders:void 0,columnSetRowCount:void 0,columnSetHeaderLines:void 0,headerLines:void 0,groupByBoxVisible:void 0,filterLineVisible:!1,previewRow:void 0,previewRowMember:void 0,previewRowLines:void 0,columns:void 0,params:void 0,defaultValues:void 0},g=_.map(_.where(c.LayoutColumn,{fFilterID:b}),function(d){return winColToESCol(a,b,c,d)}),h=_.sortBy(_.where(g,{visible:!0}),function(a){return parseInt(a.AA)}),i=_.map(h,function(a){return esColToKCol(f,a)});e=e[0],f.id=e.ID,f.caption=e.Caption,f.rootTable=e.RootTable,f.selectedMasterTable=e.SelectedMasterTable,f.selectedMasterField=e.SelectedMasterField,f.totalRow=e.TotalRow,f.columnHeaders=e.ColumnHeaders,f.columnSetHeaders=e.ColumnSetHeaders,f.columnSetRowCount=e.ColumnSetRowCount,f.columnSetHeaderLines=e.ColumnSetHeaderLines,f.headerLines=e.HeaderLines,f.groupByBoxVisible=e.GroupByBoxVisible,f.filterLineVisible=e.FilterLineVisible,f.previewRow=e.PreviewRow,f.previewRowMember=e.PreviewRowMember,f.previewRowLines=e.PreviewRowLines,f.columns=i,f.params=_.map(c.Param,function(a){return winParamInfoToesParamInfo(a,c)});var j=_.map(f.params,function(a){return a.defaultValues});return f.defaultValues=new ESParamValues(j),f}return{winGridInfoToESGridInfo:winGridInfoToESGridInfo,winColToESCol:winColToESCol,esColToKCol:esColToKCol,esGridInfoToKInfo:esGridInfoToKInfo,getZoomDataSource:prepareStdZoom,getPQDataSource:prepareWebScroller,getesComplexParamFunctionOptions:function(){return esComplexParamFunctionOptions}}}])}();